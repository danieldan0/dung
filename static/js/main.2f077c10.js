!function(t){function e(i){if(r[i])return r[i].exports;var n=r[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var r={};e.m=t,e.c=r,e.i=function(t){return t},e.d=function(t,r,i){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/dung/",e(e.s=25)}([function(t,e,r){(function(t,r){t.requestAnimationFrame=function(t){return setTimeout(t,1e3/60)},t.document={body:{appendChild:function(t){},scrollLeft:0,scrollTop:0},createElement:function(t){var e;return e={getBoundingClientRect:function(){return{left:0,top:0}},getContext:function(t){return{_termcolor:null,beginPath:function(){},canvas:e,clearRect:function(t,e,i,n){if(null!==this._termcolor){var o=this._termcolor.clearToAnsi(this.fillStyle);r.stdout.write(o)}},drawImage:function(t,e,r,i,n,o,s,a,h){},fill:function(){},fillRect:function(t,e,i,n){if(null!==this._termcolor){var o=this._termcolor.clearToAnsi(this.fillStyle);r.stdout.write(o)}},fillStyle:"#000",fillText:function(t,e,r){},font:"monospace",lineTo:function(t,e){},measureText:function(t){return{width:12}},moveTo:function(t,e){},textAlign:"center",textBaseline:"middle"}},height:0,style:{left:"100px",position:"absolute",top:"100px",visibility:"hidden"},width:0}},documentElement:{scrollLeft:0,scrollTop:0}};var i={isSupported:function(){return!(!document.createElement("canvas").getContext||!Function.prototype.bind)},DEFAULT_WIDTH:80,DEFAULT_HEIGHT:25,DIRS:{4:[[0,-1],[1,0],[0,1],[-1,0]],8:[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],6:[[-1,-1],[1,-1],[2,0],[1,1],[-1,1],[-2,0]]},VK_CANCEL:3,VK_HELP:6,VK_BACK_SPACE:8,VK_TAB:9,VK_CLEAR:12,VK_RETURN:13,VK_ENTER:14,VK_SHIFT:16,VK_CONTROL:17,VK_ALT:18,VK_PAUSE:19,VK_CAPS_LOCK:20,VK_ESCAPE:27,VK_SPACE:32,VK_PAGE_UP:33,VK_PAGE_DOWN:34,VK_END:35,VK_HOME:36,VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40,VK_PRINTSCREEN:44,VK_INSERT:45,VK_DELETE:46,VK_0:48,VK_1:49,VK_2:50,VK_3:51,VK_4:52,VK_5:53,VK_6:54,VK_7:55,VK_8:56,VK_9:57,VK_COLON:58,VK_SEMICOLON:59,VK_LESS_THAN:60,VK_EQUALS:61,VK_GREATER_THAN:62,VK_QUESTION_MARK:63,VK_AT:64,VK_A:65,VK_B:66,VK_C:67,VK_D:68,VK_E:69,VK_F:70,VK_G:71,VK_H:72,VK_I:73,VK_J:74,VK_K:75,VK_L:76,VK_M:77,VK_N:78,VK_O:79,VK_P:80,VK_Q:81,VK_R:82,VK_S:83,VK_T:84,VK_U:85,VK_V:86,VK_W:87,VK_X:88,VK_Y:89,VK_Z:90,VK_CONTEXT_MENU:93,VK_NUMPAD0:96,VK_NUMPAD1:97,VK_NUMPAD2:98,VK_NUMPAD3:99,VK_NUMPAD4:100,VK_NUMPAD5:101,VK_NUMPAD6:102,VK_NUMPAD7:103,VK_NUMPAD8:104,VK_NUMPAD9:105,VK_MULTIPLY:106,VK_ADD:107,VK_SEPARATOR:108,VK_SUBTRACT:109,VK_DECIMAL:110,VK_DIVIDE:111,VK_F1:112,VK_F2:113,VK_F3:114,VK_F4:115,VK_F5:116,VK_F6:117,VK_F7:118,VK_F8:119,VK_F9:120,VK_F10:121,VK_F11:122,VK_F12:123,VK_F13:124,VK_F14:125,VK_F15:126,VK_F16:127,VK_F17:128,VK_F18:129,VK_F19:130,VK_F20:131,VK_F21:132,VK_F22:133,VK_F23:134,VK_F24:135,VK_NUM_LOCK:144,VK_SCROLL_LOCK:145,VK_CIRCUMFLEX:160,VK_EXCLAMATION:161,VK_DOUBLE_QUOTE:162,VK_HASH:163,VK_DOLLAR:164,VK_PERCENT:165,VK_AMPERSAND:166,VK_UNDERSCORE:167,VK_OPEN_PAREN:168,VK_CLOSE_PAREN:169,VK_ASTERISK:170,VK_PLUS:171,VK_PIPE:172,VK_HYPHEN_MINUS:173,VK_OPEN_CURLY_BRACKET:174,VK_CLOSE_CURLY_BRACKET:175,VK_TILDE:176,VK_COMMA:188,VK_PERIOD:190,VK_SLASH:191,VK_BACK_QUOTE:192,VK_OPEN_BRACKET:219,VK_BACK_SLASH:220,VK_CLOSE_BRACKET:221,VK_QUOTE:222,VK_META:224,VK_ALTGR:225,VK_WIN:91,VK_KANA:21,VK_HANGUL:21,VK_EISU:22,VK_JUNJA:23,VK_FINAL:24,VK_HANJA:25,VK_KANJI:25,VK_CONVERT:28,VK_NONCONVERT:29,VK_ACCEPT:30,VK_MODECHANGE:31,VK_SELECT:41,VK_PRINT:42,VK_EXECUTE:43,VK_SLEEP:95};i.Text={RE_COLORS:/%([bc]){([^}]*)}/g,TYPE_TEXT:0,TYPE_NEWLINE:1,TYPE_FG:2,TYPE_BG:3,measure:function(t,e){for(var r={width:0,height:1},i=this.tokenize(t,e),n=0,o=0;o<i.length;o++){var s=i[o];switch(s.type){case this.TYPE_TEXT:n+=s.value.length;break;case this.TYPE_NEWLINE:r.height++,r.width=Math.max(r.width,n),n=0}}return r.width=Math.max(r.width,n),r},tokenize:function(t,e){var r=[],n=0;t.replace(this.RE_COLORS,function(e,o,s,a){var h=t.substring(n,a);return h.length&&r.push({type:i.Text.TYPE_TEXT,value:h}),r.push({type:"c"==o?i.Text.TYPE_FG:i.Text.TYPE_BG,value:s.trim()}),n=a+e.length,""});var o=t.substring(n);return o.length&&r.push({type:i.Text.TYPE_TEXT,value:o}),this._breakLines(r,e)},_breakLines:function(t,e){e||(e=1/0);for(var r=0,n=0,o=-1;r<t.length;){var s=t[r];if(s.type==i.Text.TYPE_NEWLINE&&(n=0,o=-1),s.type==i.Text.TYPE_TEXT){for(;0==n&&" "==s.value.charAt(0);)s.value=s.value.substring(1);var a=s.value.indexOf("\n");if(-1!=a){s.value=this._breakInsideToken(t,r,a,!0);for(var h=s.value.split("");h.length&&" "==h[h.length-1];)h.pop();s.value=h.join("")}if(s.value.length){if(n+s.value.length>e){for(var a=-1;;){var c=s.value.indexOf(" ",a+1);if(-1==c)break;if(n+c>e)break;a=c}if(-1!=a)s.value=this._breakInsideToken(t,r,a,!0);else if(-1!=o){var s=t[o],u=s.value.lastIndexOf(" ");s.value=this._breakInsideToken(t,o,u,!0),r=o}else s.value=this._breakInsideToken(t,r,e-n,!1)}else n+=s.value.length,-1!=s.value.indexOf(" ")&&(o=r);r++}else t.splice(r,1)}else r++}t.push({type:i.Text.TYPE_NEWLINE});for(var l=null,r=0;r<t.length;r++){var s=t[r];switch(s.type){case i.Text.TYPE_TEXT:l=s;break;case i.Text.TYPE_NEWLINE:if(l){for(var h=l.value.split("");h.length&&" "==h[h.length-1];)h.pop();l.value=h.join("")}l=null}}return t.pop(),t},_breakInsideToken:function(t,e,r,n){var o={type:i.Text.TYPE_NEWLINE},s={type:i.Text.TYPE_TEXT,value:t[e].value.substring(r+(n?1:0))};return t.splice(e+1,0,o,s),t[e].value.substring(0,r)}},Array.prototype.random=Array.prototype.random||function(){return this.length?this[Math.floor(i.RNG.getUniform()*this.length)]:null},Array.prototype.randomize=Array.prototype.randomize||function(){for(var t=[];this.length;){var e=this.indexOf(this.random());t.push(this.splice(e,1)[0])}return t},Number.prototype.mod=Number.prototype.mod||function(t){return(this%t+t)%t},String.prototype.capitalize=String.prototype.capitalize||function(){return this.charAt(0).toUpperCase()+this.substring(1)},String.prototype.lpad=String.prototype.lpad||function(t,e){for(var r=t||"0",i=e||2,n="";n.length<i-this.length;)n+=r;return(n=n.substring(0,i-this.length))+this},String.prototype.rpad=String.prototype.rpad||function(t,e){for(var r=t||"0",i=e||2,n="";n.length<i-this.length;)n+=r;return n=n.substring(0,i-this.length),this+n},String.format=String.format||function(t){var e=String.format.map,r=Array.prototype.slice.call(arguments,1),i=function(i,n,o,s){if("%"==t.charAt(s-1))return i.substring(1);if(!r.length)return i;var a=r[0],h=n||o,c=h.split(","),u=c.shift(),l=e[u.toLowerCase()];if(!l)return i;var a=r.shift(),p=a[l].apply(a,c),f=u.charAt(0);return f!=f.toLowerCase()&&(p=p.capitalize()),p};return t.replace(/%(?:([a-z]+)|(?:{([^}]+)}))/gi,i)},String.format.map=String.format.map||{s:"toString"},String.prototype.format=String.prototype.format||function(){var t=Array.prototype.slice.call(arguments);return t.unshift(this),String.format.apply(String,t)},Object.create||(Object.create=function(t){var e=function(){};return e.prototype=t,new e}),Function.prototype.extend=Function.prototype.extend||function(t){return this.prototype=Object.create(t.prototype),this.prototype.constructor=this,this},"undefined"!=typeof window&&(window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)},window.cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||function(t){return clearTimeout(t)}),i.Display=function(t){var e=document.createElement("canvas");this._context=e.getContext("2d"),this._data={},this._dirty=!1,this._options={},this._backend=null;var r={width:i.DEFAULT_WIDTH,height:i.DEFAULT_HEIGHT,transpose:!1,layout:"rect",fontSize:15,spacing:1,border:0,forceSquareRatio:!1,fontFamily:"monospace",fontStyle:"",fg:"#ccc",bg:"#000",tileWidth:32,tileHeight:32,tileMap:{},tileSet:null,tileColorize:!1,termColor:"xterm"};for(var n in t)r[n]=t[n];this.setOptions(r),this.DEBUG=this.DEBUG.bind(this),this._tick=this._tick.bind(this),requestAnimationFrame(this._tick)},i.Display.prototype.DEBUG=function(t,e,r){var i=[this._options.bg,this._options.fg];this.draw(t,e,null,null,i[r%i.length])},i.Display.prototype.clear=function(){this._data={},this._dirty=!0},i.Display.prototype.setOptions=function(t){for(var e in t)this._options[e]=t[e];if(t.width||t.height||t.fontSize||t.fontFamily||t.spacing||t.layout){t.layout&&(this._backend=new(i.Display[t.layout.capitalize()])(this._context));var r=(this._options.fontStyle?this._options.fontStyle+" ":"")+this._options.fontSize+"px "+this._options.fontFamily;this._context.font=r,this._backend.compute(this._options),this._context.font=r,this._context.textAlign="center",this._context.textBaseline="middle",this._dirty=!0}return this},i.Display.prototype.getOptions=function(){return this._options},i.Display.prototype.getContainer=function(){return this._context.canvas},i.Display.prototype.computeSize=function(t,e){return this._backend.computeSize(t,e,this._options)},i.Display.prototype.computeFontSize=function(t,e){return this._backend.computeFontSize(t,e,this._options)},i.Display.prototype.eventToPosition=function(t){if(t.touches)var e=t.touches[0].clientX,r=t.touches[0].clientY;else var e=t.clientX,r=t.clientY;var i=this._context.canvas.getBoundingClientRect();return e-=i.left,r-=i.top,e<0||r<0||e>=this._context.canvas.width||r>=this._context.canvas.height?[-1,-1]:this._backend.eventToPosition(e,r)},i.Display.prototype.draw=function(t,e,r,i,n){i||(i=this._options.fg),n||(n=this._options.bg),this._data[t+","+e]=[t,e,r,i,n],!0!==this._dirty&&(this._dirty||(this._dirty={}),this._dirty[t+","+e]=!0)},i.Display.prototype.drawText=function(t,e,r,n){var o=null,s=null,a=t,h=e,c=1;n||(n=this._options.width-t);for(var u=i.Text.tokenize(r,n);u.length;){var l=u.shift();switch(l.type){case i.Text.TYPE_TEXT:for(var p=!1,f=!1,_=!1,d=!1,g=0;g<l.value.length;g++){var y=l.value.charCodeAt(g),m=l.value.charAt(g);_=y>255&&y<65377||y>65500&&y<65512&&y>65518,p=32==m.charCodeAt(0)||12288==m.charCodeAt(0),!d||_||p||a++,_&&!f&&a++,this.draw(a++,h,m,o,s),f=p,d=_}break;case i.Text.TYPE_FG:o=l.value||null;break;case i.Text.TYPE_BG:s=l.value||null;break;case i.Text.TYPE_NEWLINE:a=t,h++,c++}}return c},i.Display.prototype._tick=function(){if(requestAnimationFrame(this._tick),this._dirty){if(!0===this._dirty){this._context.fillStyle=this._options.bg,this._context.fillRect(0,0,this._context.canvas.width,this._context.canvas.height);for(var t in this._data)this._draw(t,!1)}else for(var e in this._dirty)this._draw(e,!0);this._dirty=!1}},i.Display.prototype._draw=function(t,e){var r=this._data[t];r[4]!=this._options.bg&&(e=!0),this._backend.draw(r,e)},i.Display.Backend=function(t){this._context=t},i.Display.Backend.prototype.compute=function(t){},i.Display.Backend.prototype.draw=function(t,e){},i.Display.Backend.prototype.computeSize=function(t,e){},i.Display.Backend.prototype.computeFontSize=function(t,e){},i.Display.Backend.prototype.eventToPosition=function(t,e){},i.Display.Rect=function(t){i.Display.Backend.call(this,t),this._spacingX=0,this._spacingY=0,this._canvasCache={},this._options={}},i.Display.Rect.extend(i.Display.Backend),i.Display.Rect.cache=!1,i.Display.Rect.prototype.compute=function(t){this._canvasCache={},this._options=t;var e=Math.ceil(this._context.measureText("W").width);this._spacingX=Math.ceil(t.spacing*e),this._spacingY=Math.ceil(t.spacing*t.fontSize),this._options.forceSquareRatio&&(this._spacingX=this._spacingY=Math.max(this._spacingX,this._spacingY)),this._context.canvas.width=t.width*this._spacingX,this._context.canvas.height=t.height*this._spacingY},i.Display.Rect.prototype.draw=function(t,e){this.constructor.cache?this._drawWithCache(t,e):this._drawNoCache(t,e)},i.Display.Rect.prototype._drawWithCache=function(t,e){var r=t[0],i=t[1],n=t[2],o=t[3],s=t[4],a=""+n+o+s;if(a in this._canvasCache)var h=this._canvasCache[a];else{var c=this._options.border,h=document.createElement("canvas"),u=h.getContext("2d");if(h.width=this._spacingX,h.height=this._spacingY,u.fillStyle=s,u.fillRect(c,c,h.width-c,h.height-c),n){u.fillStyle=o,u.font=this._context.font,u.textAlign="center",u.textBaseline="middle";for(var l=[].concat(n),p=0;p<l.length;p++)u.fillText(l[p],this._spacingX/2,Math.ceil(this._spacingY/2))}this._canvasCache[a]=h}this._context.drawImage(h,r*this._spacingX,i*this._spacingY)},i.Display.Rect.prototype._drawNoCache=function(t,e){var r=t[0],i=t[1],n=t[2],o=t[3],s=t[4];if(e){var a=this._options.border;this._context.fillStyle=s,this._context.fillRect(r*this._spacingX+a,i*this._spacingY+a,this._spacingX-a,this._spacingY-a)}if(n){this._context.fillStyle=o;for(var h=[].concat(n),c=0;c<h.length;c++)this._context.fillText(h[c],(r+.5)*this._spacingX,Math.ceil((i+.5)*this._spacingY))}},i.Display.Rect.prototype.computeSize=function(t,e){return[Math.floor(t/this._spacingX),Math.floor(e/this._spacingY)]},i.Display.Rect.prototype.computeFontSize=function(t,e){var r=Math.floor(t/this._options.width),i=Math.floor(e/this._options.height),n=this._context.font;this._context.font="100px "+this._options.fontFamily;var o=Math.ceil(this._context.measureText("W").width);this._context.font=n;var s=o/100,a=s*i/r;return a>1&&(i=Math.floor(i/a)),Math.floor(i/this._options.spacing)},i.Display.Rect.prototype.eventToPosition=function(t,e){return[Math.floor(t/this._spacingX),Math.floor(e/this._spacingY)]},i.Display.Hex=function(t){i.Display.Backend.call(this,t),this._spacingX=0,this._spacingY=0,this._hexSize=0,this._options={}},i.Display.Hex.extend(i.Display.Backend),i.Display.Hex.prototype.compute=function(t){this._options=t;var e=Math.ceil(this._context.measureText("W").width);if(this._hexSize=Math.floor(t.spacing*(t.fontSize+e/Math.sqrt(3))/2),this._spacingX=this._hexSize*Math.sqrt(3)/2,this._spacingY=1.5*this._hexSize,t.transpose)var r="height",i="width";else var r="width",i="height";this._context.canvas[r]=Math.ceil((t.width+1)*this._spacingX),this._context.canvas[i]=Math.ceil((t.height-1)*this._spacingY+2*this._hexSize)},i.Display.Hex.prototype.draw=function(t,e){var r=t[0],i=t[1],n=t[2],o=t[3],s=t[4],a=[(r+1)*this._spacingX,i*this._spacingY+this._hexSize];if(this._options.transpose&&a.reverse(),e&&(this._context.fillStyle=s,this._fill(a[0],a[1])),n){this._context.fillStyle=o;for(var h=[].concat(n),c=0;c<h.length;c++)this._context.fillText(h[c],a[0],Math.ceil(a[1]))}},i.Display.Hex.prototype.computeSize=function(t,e){return this._options.transpose&&(t+=e,e=t-e,t-=e),[Math.floor(t/this._spacingX)-1,Math.floor((e-2*this._hexSize)/this._spacingY+1)]},i.Display.Hex.prototype.computeFontSize=function(t,e){this._options.transpose&&(t+=e,e=t-e,t-=e);var r=2*t/((this._options.width+1)*Math.sqrt(3))-1,i=e/(2+1.5*(this._options.height-1)),n=Math.min(r,i),o=this._context.font;this._context.font="100px "+this._options.fontFamily;var s=Math.ceil(this._context.measureText("W").width);this._context.font=o;var a=s/100;n=Math.floor(n)+1;var h=2*n/(this._options.spacing*(1+a/Math.sqrt(3)));return Math.ceil(h)-1},i.Display.Hex.prototype.eventToPosition=function(t,e){if(this._options.transpose){t+=e,e=t-e,t-=e;var r="width"}else var r="height";var i=this._context.canvas[r]/this._options[r];return e=Math.floor(e/i),e.mod(2)?(t-=this._spacingX,t=1+2*Math.floor(t/(2*this._spacingX))):t=2*Math.floor(t/(2*this._spacingX)),[t,e]},i.Display.Hex.prototype._fill=function(t,e){var r=this._hexSize,i=this._options.border;this._context.beginPath(),this._options.transpose?(this._context.moveTo(t-r+i,e),this._context.lineTo(t-r/2+i,e+this._spacingX-i),this._context.lineTo(t+r/2-i,e+this._spacingX-i),this._context.lineTo(t+r-i,e),this._context.lineTo(t+r/2-i,e-this._spacingX+i),this._context.lineTo(t-r/2+i,e-this._spacingX+i),this._context.lineTo(t-r+i,e)):(this._context.moveTo(t,e-r+i),this._context.lineTo(t+this._spacingX-i,e-r/2+i),this._context.lineTo(t+this._spacingX-i,e+r/2-i),this._context.lineTo(t,e+r-i),this._context.lineTo(t-this._spacingX+i,e+r/2-i),this._context.lineTo(t-this._spacingX+i,e-r/2+i),this._context.lineTo(t,e-r+i)),this._context.fill()},i.Display.Tile=function(t){i.Display.Rect.call(this,t),this._options={},this._colorCanvas=document.createElement("canvas")},i.Display.Tile.extend(i.Display.Rect),i.Display.Tile.prototype.compute=function(t){this._options=t,this._context.canvas.width=t.width*t.tileWidth,this._context.canvas.height=t.height*t.tileHeight,this._colorCanvas.width=t.tileWidth,this._colorCanvas.height=t.tileHeight},i.Display.Tile.prototype.draw=function(t,e){var r=t[0],i=t[1],n=t[2],o=t[3],s=t[4],a=this._options.tileWidth,h=this._options.tileHeight;if(e&&(this._options.tileColorize?this._context.clearRect(r*a,i*h,a,h):(this._context.fillStyle=s,this._context.fillRect(r*a,i*h,a,h))),n)for(var c=[].concat(n),u=0;u<c.length;u++){var l=this._options.tileMap[c[u]];if(!l)throw new Error("Char '"+c[u]+"' not found in tileMap");if(this._options.tileColorize){var p=this._colorCanvas,f=p.getContext("2d");f.clearRect(0,0,a,h),f.drawImage(this._options.tileSet,l[0],l[1],a,h,0,0,a,h),"transparent"!=o&&(f.fillStyle=o,f.globalCompositeOperation="source-atop",f.fillRect(0,0,a,h)),"transparent"!=s&&(f.fillStyle=s,f.globalCompositeOperation="destination-over",f.fillRect(0,0,a,h)),this._context.drawImage(p,r*a,i*h,a,h)}else this._context.drawImage(this._options.tileSet,l[0],l[1],a,h,r*a,i*h,a,h)}},i.Display.Tile.prototype.computeSize=function(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]},i.Display.Tile.prototype.computeFontSize=function(t,e){return[Math.floor(t/this._options.width),Math.floor(e/this._options.height)]},i.Display.Tile.prototype.eventToPosition=function(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]},i.RNG={getSeed:function(){return this._seed},setSeed:function(t){return t=t<1?1/t:t,this._seed=t,this._s0=(t>>>0)*this._frac,t=69069*t+1>>>0,this._s1=t*this._frac,t=69069*t+1>>>0,this._s2=t*this._frac,this._c=1,this},getUniform:function(){var t=2091639*this._s0+this._c*this._frac;return this._s0=this._s1,this._s1=this._s2,this._c=0|t,this._s2=t-this._c,this._s2},getUniformInt:function(t,e){var r=Math.max(t,e),i=Math.min(t,e);return Math.floor(this.getUniform()*(r-i+1))+i},getNormal:function(t,e){do{var r=2*this.getUniform()-1,i=2*this.getUniform()-1,n=r*r+i*i}while(n>1||0==n);var o=r*Math.sqrt(-2*Math.log(n)/n);return(t||0)+o*(e||1)},getPercentage:function(){return 1+Math.floor(100*this.getUniform())},getWeightedValue:function(t){var e=0;for(var r in t)e+=t[r];var i=this.getUniform()*e,n=0;for(var r in t)if(n+=t[r],i<n)return r;return r},getState:function(){return[this._s0,this._s1,this._s2,this._c]},setState:function(t){return this._s0=t[0],this._s1=t[1],this._s2=t[2],this._c=t[3],this},clone:function(){var t=Object.create(this);return t.setState(this.getState()),t},_s0:0,_s1:0,_s2:0,_c:0,_frac:2.3283064365386963e-10},i.RNG.setSeed(Date.now()),i.StringGenerator=function(t){this._options={words:!1,order:3,prior:.001};for(var e in t)this._options[e]=t[e];this._boundary=String.fromCharCode(0),this._suffix=this._boundary,this._prefix=[];for(var r=0;r<this._options.order;r++)this._prefix.push(this._boundary);this._priorValues={},this._priorValues[this._boundary]=this._options.prior,this._data={}},i.StringGenerator.prototype.clear=function(){this._data={},this._priorValues={}},i.StringGenerator.prototype.generate=function(){for(var t=[this._sample(this._prefix)];t[t.length-1]!=this._boundary;)t.push(this._sample(t));return this._join(t.slice(0,-1))},i.StringGenerator.prototype.observe=function(t){for(var e=this._split(t),r=0;r<e.length;r++)this._priorValues[e[r]]=this._options.prior;e=this._prefix.concat(e).concat(this._suffix);for(var r=this._options.order;r<e.length;r++)for(var i=e.slice(r-this._options.order,r),n=e[r],o=0;o<i.length;o++){var s=i.slice(o);this._observeEvent(s,n)}},i.StringGenerator.prototype.getStats=function(){var t=[],e=0;for(var r in this._priorValues)e++;e--,t.push("distinct samples: "+e);var i=0,n=0;for(var r in this._data){i++;for(var o in this._data[r])n++}return t.push("dictionary size (contexts): "+i),t.push("dictionary size (events): "+n),t.join(", ")},i.StringGenerator.prototype._split=function(t){return t.split(this._options.words?/\s+/:"")},i.StringGenerator.prototype._join=function(t){return t.join(this._options.words?" ":"")},i.StringGenerator.prototype._observeEvent=function(t,e){var r=this._join(t);r in this._data||(this._data[r]={});var i=this._data[r];e in i||(i[e]=0),i[e]++},i.StringGenerator.prototype._sample=function(t){t=this._backoff(t);var e=this._join(t),r=this._data[e],n={};if(this._options.prior){for(var o in this._priorValues)n[o]=this._priorValues[o];for(var o in r)n[o]+=r[o]}else n=r;return i.RNG.getWeightedValue(n)},i.StringGenerator.prototype._backoff=function(t){for(t.length>this._options.order?t=t.slice(-this._options.order):t.length<this._options.order&&(t=this._prefix.slice(0,this._options.order-t.length).concat(t));!(this._join(t)in this._data)&&t.length>0;)t=t.slice(1);return t},i.EventQueue=function(){this._time=0,this._events=[],this._eventTimes=[]},i.EventQueue.prototype.getTime=function(){return this._time},i.EventQueue.prototype.clear=function(){return this._events=[],this._eventTimes=[],this},i.EventQueue.prototype.add=function(t,e){for(var r=this._events.length,i=0;i<this._eventTimes.length;i++)if(this._eventTimes[i]>e){r=i;break}this._events.splice(r,0,t),this._eventTimes.splice(r,0,e)},i.EventQueue.prototype.get=function(){if(!this._events.length)return null;var t=this._eventTimes.splice(0,1)[0];if(t>0){this._time+=t;for(var e=0;e<this._eventTimes.length;e++)this._eventTimes[e]-=t}return this._events.splice(0,1)[0]},i.EventQueue.prototype.remove=function(t){var e=this._events.indexOf(t);return-1!=e&&(this._remove(e),!0)},i.EventQueue.prototype._remove=function(t){this._events.splice(t,1),this._eventTimes.splice(t,1)},i.Scheduler=function(){this._queue=new i.EventQueue,this._repeat=[],this._current=null},i.Scheduler.prototype.getTime=function(){return this._queue.getTime()},i.Scheduler.prototype.add=function(t,e){return e&&this._repeat.push(t),this},i.Scheduler.prototype.clear=function(){return this._queue.clear(),this._repeat=[],this._current=null,this},i.Scheduler.prototype.remove=function(t){var e=this._queue.remove(t),r=this._repeat.indexOf(t);return-1!=r&&this._repeat.splice(r,1),this._current==t&&(this._current=null),e},i.Scheduler.prototype.next=function(){return this._current=this._queue.get(),this._current},i.Scheduler.Simple=function(){i.Scheduler.call(this)},i.Scheduler.Simple.extend(i.Scheduler),i.Scheduler.Simple.prototype.add=function(t,e){return this._queue.add(t,0),i.Scheduler.prototype.add.call(this,t,e)},i.Scheduler.Simple.prototype.next=function(){return this._current&&-1!=this._repeat.indexOf(this._current)&&this._queue.add(this._current,0),i.Scheduler.prototype.next.call(this)},i.Scheduler.Speed=function(){i.Scheduler.call(this)},i.Scheduler.Speed.extend(i.Scheduler),i.Scheduler.Speed.prototype.add=function(t,e){return this._queue.add(t,1/t.getSpeed()),i.Scheduler.prototype.add.call(this,t,e)},i.Scheduler.Speed.prototype.next=function(){return this._current&&-1!=this._repeat.indexOf(this._current)&&this._queue.add(this._current,1/this._current.getSpeed()),i.Scheduler.prototype.next.call(this)},i.Scheduler.Action=function(){i.Scheduler.call(this),this._defaultDuration=1,this._duration=this._defaultDuration},i.Scheduler.Action.extend(i.Scheduler),i.Scheduler.Action.prototype.add=function(t,e,r){return this._queue.add(t,r||this._defaultDuration),i.Scheduler.prototype.add.call(this,t,e)},i.Scheduler.Action.prototype.clear=function(){return this._duration=this._defaultDuration,i.Scheduler.prototype.clear.call(this)},i.Scheduler.Action.prototype.remove=function(t){return t==this._current&&(this._duration=this._defaultDuration),i.Scheduler.prototype.remove.call(this,t)},i.Scheduler.Action.prototype.next=function(){return this._current&&-1!=this._repeat.indexOf(this._current)&&(this._queue.add(this._current,this._duration||this._defaultDuration),this._duration=this._defaultDuration),i.Scheduler.prototype.next.call(this)},i.Scheduler.Action.prototype.setDuration=function(t){return this._current&&(this._duration=t),this},i.Engine=function(t){this._scheduler=t,this._lock=1},i.Engine.prototype.start=function(){return this.unlock()},i.Engine.prototype.lock=function(){return this._lock++,this},i.Engine.prototype.unlock=function(){if(!this._lock)throw new Error("Cannot unlock unlocked engine");for(this._lock--;!this._lock;){var t=this._scheduler.next();if(!t)return this.lock();var e=t.act();e&&e.then&&(this.lock(),e.then(this.unlock.bind(this)))}return this},i.Map=function(t,e){this._width=t||i.DEFAULT_WIDTH,this._height=e||i.DEFAULT_HEIGHT},i.Map.prototype.create=function(t){},i.Map.prototype._fillMap=function(t){for(var e=[],r=0;r<this._width;r++){e.push([]);for(var i=0;i<this._height;i++)e[r].push(t)}return e},i.Map.Arena=function(t,e){i.Map.call(this,t,e)},i.Map.Arena.extend(i.Map),i.Map.Arena.prototype.create=function(t){for(var e=this._width-1,r=this._height-1,i=0;i<=e;i++)for(var n=0;n<=r;n++){var o=i&&n&&i<e&&n<r;t(i,n,o?0:1)}return this},i.Map.DividedMaze=function(t,e){i.Map.call(this,t,e),this._stack=[]},i.Map.DividedMaze.extend(i.Map),i.Map.DividedMaze.prototype.create=function(t){var e=this._width,r=this._height;this._map=[];for(var i=0;i<e;i++){this._map.push([]);for(var n=0;n<r;n++){var o=0==i||0==n||i+1==e||n+1==r;this._map[i].push(o?1:0)}}this._stack=[[1,1,e-2,r-2]],this._process();for(var i=0;i<e;i++)for(var n=0;n<r;n++)t(i,n,this._map[i][n]);return this._map=null,this},i.Map.DividedMaze.prototype._process=function(){for(;this._stack.length;){var t=this._stack.shift();this._partitionRoom(t)}},i.Map.DividedMaze.prototype._partitionRoom=function(t){for(var e=[],r=[],i=t[0]+1;i<t[2];i++){var n=this._map[i][t[1]-1],o=this._map[i][t[3]+1];!n||!o||i%2||e.push(i)}for(var s=t[1]+1;s<t[3];s++){var a=this._map[t[0]-1][s],h=this._map[t[2]+1][s];!a||!h||s%2||r.push(s)}if(e.length&&r.length){var c=e.random(),u=r.random();this._map[c][u]=1;var l=[],p=[];l.push(p);for(var i=t[0];i<c;i++)this._map[i][u]=1,p.push([i,u]);var p=[];l.push(p);for(var i=c+1;i<=t[2];i++)this._map[i][u]=1,p.push([i,u]);var p=[];l.push(p);for(var s=t[1];s<u;s++)this._map[c][s]=1,p.push([c,s]);var p=[];l.push(p);for(var s=u+1;s<=t[3];s++)this._map[c][s]=1,p.push([c,s]);for(var f=l.random(),i=0;i<l.length;i++){var p=l[i];if(p!=f){var _=p.random();this._map[_[0]][_[1]]=0}}this._stack.push([t[0],t[1],c-1,u-1]),this._stack.push([c+1,t[1],t[2],u-1]),this._stack.push([t[0],u+1,c-1,t[3]]),this._stack.push([c+1,u+1,t[2],t[3]])}},i.Map.IceyMaze=function(t,e,r){i.Map.call(this,t,e),this._regularity=r||0},i.Map.IceyMaze.extend(i.Map),i.Map.IceyMaze.prototype.create=function(t){var e=this._width,r=this._height,n=this._fillMap(1);e-=e%2?1:2,r-=r%2?1:2;var o=0,s=0,a=0,h=0,c=0,u=!1,l=[[0,0],[0,0],[0,0],[0,0]];do{if(o=1+2*Math.floor(i.RNG.getUniform()*(e-1)/2),s=1+2*Math.floor(i.RNG.getUniform()*(r-1)/2),c||(n[o][s]=0),!n[o][s]){this._randomize(l);do{0==Math.floor(i.RNG.getUniform()*(this._regularity+1))&&this._randomize(l),u=!0;for(var p=0;p<4;p++)if(a=o+2*l[p][0],h=s+2*l[p][1],this._isFree(n,a,h,e,r)){n[a][h]=0,n[o+l[p][0]][s+l[p][1]]=0,o=a,s=h,u=!1,c++;break}}while(!u)}}while(c+1<e*r/4);for(var p=0;p<this._width;p++)for(var f=0;f<this._height;f++)t(p,f,n[p][f]);return this._map=null,this},i.Map.IceyMaze.prototype._randomize=function(t){for(var e=0;e<4;e++)t[e][0]=0,t[e][1]=0;switch(Math.floor(4*i.RNG.getUniform())){case 0:t[0][0]=-1,t[1][0]=1,t[2][1]=-1,t[3][1]=1;break;case 1:t[3][0]=-1,t[2][0]=1,t[1][1]=-1,t[0][1]=1;break;case 2:t[2][0]=-1,t[3][0]=1,t[0][1]=-1,t[1][1]=1;break;case 3:t[1][0]=-1,t[0][0]=1,t[3][1]=-1,t[2][1]=1}},i.Map.IceyMaze.prototype._isFree=function(t,e,r,i,n){return!(e<1||r<1||e>=i||r>=n)&&t[e][r]},i.Map.EllerMaze=function(t,e){i.Map.call(this,t,e)},i.Map.EllerMaze.extend(i.Map),i.Map.EllerMaze.prototype.create=function(t){for(var e=this._fillMap(1),r=Math.ceil((this._width-2)/2),n=[],o=[],s=0;s<r;s++)n.push(s),o.push(s);n.push(r-1);for(var a=1;a+3<this._height;a+=2)for(var s=0;s<r;s++){var h=2*s+1,c=a;e[h][c]=0,s!=n[s+1]&&i.RNG.getUniform()>.375&&(this._addToList(s,n,o),e[h+1][c]=0),s!=n[s]&&i.RNG.getUniform()>.375?this._removeFromList(s,n,o):e[h][c+1]=0}for(var s=0;s<r;s++){var h=2*s+1,c=a;e[h][c]=0,s!=n[s+1]&&(s==n[s]||i.RNG.getUniform()>.375)&&(this._addToList(s,n,o),e[h+1][c]=0),this._removeFromList(s,n,o)}for(var s=0;s<this._width;s++)for(var a=0;a<this._height;a++)t(s,a,e[s][a]);return this},i.Map.EllerMaze.prototype._removeFromList=function(t,e,r){r[e[t]]=r[t],e[r[t]]=e[t],r[t]=t,e[t]=t},i.Map.EllerMaze.prototype._addToList=function(t,e,r){r[e[t+1]]=r[t],e[r[t]]=e[t+1],r[t]=t+1,e[t+1]=t},i.Map.Cellular=function(t,e,r){i.Map.call(this,t,e),this._options={born:[5,6,7,8],survive:[4,5,6,7,8],topology:8,connected:!1},this.setOptions(r),this._dirs=i.DIRS[this._options.topology],this._map=this._fillMap(0)},i.Map.Cellular.extend(i.Map),i.Map.Cellular.prototype.randomize=function(t){for(var e=0;e<this._width;e++)for(var r=0;r<this._height;r++)this._map[e][r]=i.RNG.getUniform()<t?1:0;return this},i.Map.Cellular.prototype.setOptions=function(t){for(var e in t)this._options[e]=t[e]},i.Map.Cellular.prototype.set=function(t,e,r){this._map[t][e]=r},i.Map.Cellular.prototype.create=function(t){for(var e=this._fillMap(0),r=this._options.born,i=this._options.survive,n=0;n<this._height;n++){var o=1,s=0;6==this._options.topology&&(o=2,s=n%2);for(var a=s;a<this._width;a+=o){var h=this._map[a][n],c=this._getNeighbors(a,n);h&&-1!=i.indexOf(c)?e[a][n]=1:h||-1==r.indexOf(c)||(e[a][n]=1)}}if(this._map=e,this._options.connected&&this._completeMaze(),t)for(var n=0;n<this._height;n++){var o=1,s=0;6==this._options.topology&&(o=2,s=n%2);for(var a=s;a<this._width;a+=o)t(a,n,e[a][n])}},i.Map.Cellular.prototype._getNeighbors=function(t,e){for(var r=0,i=0;i<this._dirs.length;i++){var n=this._dirs[i],o=t+n[0],s=e+n[1];o<0||o>=this._width||o<0||s>=this._width||(r+=1==this._map[o][s]?1:0)}return r},i.Map.Cellular.prototype._completeMaze=function(){for(var t=[],e={},r=0;r<this._width;r++)for(var n=0;n<this._height;n++)if(this._freeSpace(r,n)){var o=[r,n];e[this._pointKey(o)]=o,t.push([r,n])}var s=t[i.RNG.getUniformInt(0,t.length-1)],a=this._pointKey(s),h={};for(h[a]=s,delete e[a],this._findConnected(h,e,[s]);Object.keys(e).length>0;){var o=this._getFromTo(h,e),c=o[0],u=o[1],l={};l[this._pointKey(c)]=c,this._findConnected(l,e,[c],!0),this._tunnelToConnected(u,c,h,e);for(var p in l){var f=l[p];this._map[f[0]][f[1]]=0,h[p]=f,delete e[p]}}},i.Map.Cellular.prototype._getFromTo=function(t,e){for(var r,n,o=Object.keys(t),s=Object.keys(e),a=0;a<5;a++){if(o.length<s.length){var h=o;n=t[h[i.RNG.getUniformInt(0,h.length-1)]],r=this._getClosest(n,e)}else{var h=s;r=e[h[i.RNG.getUniformInt(0,h.length-1)]],n=this._getClosest(r,t)}if((r[0]-n[0])*(r[0]-n[0])+(r[1]-n[1])*(r[1]-n[1])<64)break}return[r,n]},i.Map.Cellular.prototype._getClosest=function(t,e){var r=null,i=null;for(k in e){var n=e[k],o=(n[0]-t[0])*(n[0]-t[0])+(n[1]-t[1])*(n[1]-t[1]);(null==i||o<i)&&(i=o,r=n)}return r},i.Map.Cellular.prototype._findConnected=function(t,e,r,i){for(;r.length>0;)for(var n=r.splice(0,1)[0],o=[[n[0]+1,n[1]],[n[0]-1,n[1]],[n[0],n[1]+1],[n[0],n[1]-1]],s=0;s<o.length;s++){var a=this._pointKey(o[s]);null==t[a]&&this._freeSpace(o[s][0],o[s][1])&&(t[a]=o[s],i||delete e[a],r.push(o[s]))}},i.Map.Cellular.prototype._tunnelToConnected=function(t,e,r,i){var n,o;this._pointKey(e);e[0]<t[0]?(n=e,o=t):(n=t,o=e);for(var s=n[0];s<=o[0];s++){this._map[s][n[1]]=0;var a=[s,n[1]],h=this._pointKey(a);r[h]=a,delete i[h]}var c=o[0];e[1]<t[1]?(n=e,o=t):(n=t,o=e);for(var u=n[1];u<o[1];u++){this._map[c][u]=0;var a=[c,u],h=this._pointKey(a);r[h]=a,delete i[h]}},i.Map.Cellular.prototype._freeSpace=function(t,e){return t>=0&&t<this._width&&e>=0&&e<this._height&&1!=this._map[t][e]},i.Map.Cellular.prototype._pointKey=function(t){return t[0]+"."+t[1]},i.Map.Dungeon=function(t,e){i.Map.call(this,t,e),this._rooms=[],this._corridors=[]},i.Map.Dungeon.extend(i.Map),i.Map.Dungeon.prototype.getRooms=function(){return this._rooms},i.Map.Dungeon.prototype.getCorridors=function(){return this._corridors},i.Map.Digger=function(t,e,r){i.Map.Dungeon.call(this,t,e),this._options={roomWidth:[3,9],roomHeight:[3,5],corridorLength:[3,10],dugPercentage:.2,timeLimit:1e3};for(var n in r)this._options[n]=r[n];this._features={Room:4,Corridor:4},this._featureAttempts=20,this._walls={},this._digCallback=this._digCallback.bind(this),this._canBeDugCallback=this._canBeDugCallback.bind(this),this._isWallCallback=this._isWallCallback.bind(this),this._priorityWallCallback=this._priorityWallCallback.bind(this)},i.Map.Digger.extend(i.Map.Dungeon),i.Map.Digger.prototype.create=function(t){this._rooms=[],this._corridors=[],this._map=this._fillMap(1),this._walls={},this._dug=0;var e=(this._width-2)*(this._height-2);this._firstRoom();var r=Date.now();do{if(Date.now()-r>this._options.timeLimit)break;var i=this._findWall();if(!i)break;var n=i.split(","),o=parseInt(n[0]),s=parseInt(n[1]),a=this._getDiggingDirection(o,s);if(a){var h=0;do{if(h++,this._tryFeature(o,s,a[0],a[1])){this._removeSurroundingWalls(o,s),this._removeSurroundingWalls(o-a[0],s-a[1]);break}}while(h<this._featureAttempts);var c=0;for(var u in this._walls)this._walls[u]>1&&c++}}while(this._dug/e<this._options.dugPercentage||c);if(this._addDoors(),t)for(var l=0;l<this._width;l++)for(var p=0;p<this._height;p++)t(l,p,this._map[l][p]);return this._walls={},this._map=null,this},i.Map.Digger.prototype._digCallback=function(t,e,r){0==r||2==r?(this._map[t][e]=0,this._dug++):this._walls[t+","+e]=1},i.Map.Digger.prototype._isWallCallback=function(t,e){return!(t<0||e<0||t>=this._width||e>=this._height)&&1==this._map[t][e]},i.Map.Digger.prototype._canBeDugCallback=function(t,e){return!(t<1||e<1||t+1>=this._width||e+1>=this._height)&&1==this._map[t][e]},i.Map.Digger.prototype._priorityWallCallback=function(t,e){this._walls[t+","+e]=2},i.Map.Digger.prototype._firstRoom=function(){var t=Math.floor(this._width/2),e=Math.floor(this._height/2),r=i.Map.Feature.Room.createRandomCenter(t,e,this._options);this._rooms.push(r),r.create(this._digCallback)},i.Map.Digger.prototype._findWall=function(){var t=[],e=[];for(var r in this._walls){2==this._walls[r]?e.push(r):t.push(r)}var i=e.length?e:t;if(!i.length)return null;var r=i.random();return delete this._walls[r],r},i.Map.Digger.prototype._tryFeature=function(t,e,r,n){var o=i.RNG.getWeightedValue(this._features);return o=i.Map.Feature[o].createRandomAt(t,e,r,n,this._options),!!o.isValid(this._isWallCallback,this._canBeDugCallback)&&(o.create(this._digCallback),o instanceof i.Map.Feature.Room&&this._rooms.push(o),o instanceof i.Map.Feature.Corridor&&(o.createPriorityWalls(this._priorityWallCallback),this._corridors.push(o)),!0)},i.Map.Digger.prototype._removeSurroundingWalls=function(t,e){for(var r=i.DIRS[4],n=0;n<r.length;n++){var o=r[n],s=t+o[0],a=e+o[1];delete this._walls[s+","+a];var s=t+2*o[0],a=e+2*o[1];delete this._walls[s+","+a]}},i.Map.Digger.prototype._getDiggingDirection=function(t,e){if(t<=0||e<=0||t>=this._width-1||e>=this._height-1)return null;for(var r=null,n=i.DIRS[4],o=0;o<n.length;o++){var s=n[o],a=t+s[0],h=e+s[1];if(!this._map[a][h]){if(r)return null;r=s}}return r?[-r[0],-r[1]]:null},i.Map.Digger.prototype._addDoors=function(){for(var t=this._map,e=function(e,r){return 1==t[e][r]},r=0;r<this._rooms.length;r++){var i=this._rooms[r];i.clearDoors(),i.addDoors(e)}},i.Map.Uniform=function(t,e,r){i.Map.Dungeon.call(this,t,e),this._options={roomWidth:[3,9],roomHeight:[3,5],roomDugPercentage:.1,timeLimit:1e3};for(var n in r)this._options[n]=r[n];this._roomAttempts=20,this._corridorAttempts=20,this._connected=[],this._unconnected=[],this._digCallback=this._digCallback.bind(this),this._canBeDugCallback=this._canBeDugCallback.bind(this),this._isWallCallback=this._isWallCallback.bind(this)},i.Map.Uniform.extend(i.Map.Dungeon),i.Map.Uniform.prototype.create=function(t){for(var e=Date.now();;){if(Date.now()-e>this._options.timeLimit)return null;if(this._map=this._fillMap(1),this._dug=0,this._rooms=[],this._unconnected=[],this._generateRooms(),!(this._rooms.length<2)&&this._generateCorridors())break}if(t)for(var r=0;r<this._width;r++)for(var i=0;i<this._height;i++)t(r,i,this._map[r][i]);return this},i.Map.Uniform.prototype._generateRooms=function(){var t=this._width-2,e=this._height-2;do{var r=this._generateRoom();if(this._dug/(t*e)>this._options.roomDugPercentage)break}while(r)},i.Map.Uniform.prototype._generateRoom=function(){for(var t=0;t<this._roomAttempts;){t++;var e=i.Map.Feature.Room.createRandom(this._width,this._height,this._options);if(e.isValid(this._isWallCallback,this._canBeDugCallback))return e.create(this._digCallback),this._rooms.push(e),e}return null},i.Map.Uniform.prototype._generateCorridors=function(){for(var t=0;t<this._corridorAttempts;){t++,this._corridors=[],this._map=this._fillMap(1);for(var e=0;e<this._rooms.length;e++){var r=this._rooms[e];r.clearDoors(),r.create(this._digCallback)}for(this._unconnected=this._rooms.slice().randomize(),this._connected=[],this._unconnected.length&&this._connected.push(this._unconnected.pop());;){var i=this._connected.random(),n=this._closestRoom(this._unconnected,i),o=this._closestRoom(this._connected,n);if(!this._connectRooms(n,o))break;if(!this._unconnected.length)return!0}}return!1},i.Map.Uniform.prototype._closestRoom=function(t,e){for(var r=1/0,i=e.getCenter(),n=null,o=0;o<t.length;o++){var s=t[o],a=s.getCenter(),h=a[0]-i[0],c=a[1]-i[1],u=h*h+c*c;u<r&&(r=u,n=s)}return n},i.Map.Uniform.prototype._connectRooms=function(t,e){var r=t.getCenter(),i=e.getCenter(),n=i[0]-r[0],o=i[1]-r[1];if(Math.abs(n)<Math.abs(o))var s=o>0?2:0,a=(s+2)%4,h=e.getLeft(),c=e.getRight(),u=0;else var s=n>0?1:3,a=(s+2)%4,h=e.getTop(),c=e.getBottom(),u=1;var l=this._placeInWall(t,s);if(!l)return!1;if(l[u]>=h&&l[u]<=c){var p=l.slice(),f=null;switch(a){case 0:f=e.getTop()-1;break;case 1:f=e.getRight()+1;break;case 2:f=e.getBottom()+1;break;case 3:f=e.getLeft()-1}p[(u+1)%2]=f,this._digLine([l,p])}else if(l[u]<h-1||l[u]>c+1){var _=l[u]-i[u];switch(a){case 0:case 1:var d=_<0?3:1;break;case 2:case 3:var d=_<0?1:3}a=(a+d)%4;var p=this._placeInWall(e,a);if(!p)return!1;var g=[0,0];g[u]=l[u];var y=(u+1)%2;g[y]=p[y],this._digLine([l,g,p])}else{var y=(u+1)%2,p=this._placeInWall(e,a);if(!p)return!1;var g=Math.round((p[y]+l[y])/2),m=[0,0],v=[0,0];m[u]=l[u],m[y]=g,v[u]=p[u],v[y]=g,this._digLine([l,m,v,p])}t.addDoor(l[0],l[1]),e.addDoor(p[0],p[1]);var u=this._unconnected.indexOf(t);-1!=u&&(this._unconnected.splice(u,1),this._connected.push(t));var u=this._unconnected.indexOf(e);return-1!=u&&(this._unconnected.splice(u,1),this._connected.push(e)),!0},i.Map.Uniform.prototype._placeInWall=function(t,e){var r=[0,0],i=[0,0],n=0;switch(e){case 0:i=[1,0],r=[t.getLeft(),t.getTop()-1],n=t.getRight()-t.getLeft()+1;break;case 1:i=[0,1],r=[t.getRight()+1,t.getTop()],n=t.getBottom()-t.getTop()+1;break;case 2:i=[1,0],r=[t.getLeft(),t.getBottom()+1],n=t.getRight()-t.getLeft()+1;break;case 3:i=[0,1],r=[t.getLeft()-1,t.getTop()],n=t.getBottom()-t.getTop()+1}for(var o=[],s=-2,a=0;a<n;a++){var h=r[0]+a*i[0],c=r[1]+a*i[1];o.push(null);1==this._map[h][c]?s!=a-1&&(o[a]=[h,c]):(s=a,a&&(o[a-1]=null))}for(var a=o.length-1;a>=0;a--)o[a]||o.splice(a,1);return o.length?o.random():null},i.Map.Uniform.prototype._digLine=function(t){for(var e=1;e<t.length;e++){var r=t[e-1],n=t[e],o=new i.Map.Feature.Corridor(r[0],r[1],n[0],n[1]);o.create(this._digCallback),this._corridors.push(o)}},i.Map.Uniform.prototype._digCallback=function(t,e,r){this._map[t][e]=r,0==r&&this._dug++},i.Map.Uniform.prototype._isWallCallback=function(t,e){return!(t<0||e<0||t>=this._width||e>=this._height)&&1==this._map[t][e]},i.Map.Uniform.prototype._canBeDugCallback=function(t,e){return!(t<1||e<1||t+1>=this._width||e+1>=this._height)&&1==this._map[t][e]},i.Map.Rogue=function(t,e,r){i.Map.call(this,t,e),this._options={cellWidth:3,cellHeight:3};for(var n in r)this._options[n]=r[n];this._options.hasOwnProperty("roomWidth")||(this._options.roomWidth=this._calculateRoomSize(this._width,this._options.cellWidth)),this._options.hasOwnProperty("roomHeight")||(this._options.roomHeight=this._calculateRoomSize(this._height,this._options.cellHeight))},i.Map.Rogue.extend(i.Map),i.Map.Rogue.prototype.create=function(t){if(this.map=this._fillMap(1),this.rooms=[],this.connectedCells=[],this._initRooms(),this._connectRooms(),this._connectUnconnectedRooms(),this._createRandomRoomConnections(),this._createRooms(),this._createCorridors(),t)for(var e=0;e<this._width;e++)for(var r=0;r<this._height;r++)t(e,r,this.map[e][r]);return this},i.Map.Rogue.prototype._calculateRoomSize=function(t,e){var r=Math.floor(t/e*.8),i=Math.floor(t/e*.25);return i<2&&(i=2),r<2&&(r=2),[i,r]},i.Map.Rogue.prototype._initRooms=function(){for(var t=0;t<this._options.cellWidth;t++){this.rooms.push([]);for(var e=0;e<this._options.cellHeight;e++)this.rooms[t].push({x:0,y:0,width:0,height:0,connections:[],cellx:t,celly:e})}},i.Map.Rogue.prototype._connectRooms=function(){var t,e,r,n,o,s=i.RNG.getUniformInt(0,this._options.cellWidth-1),a=i.RNG.getUniformInt(0,this._options.cellHeight-1),h=!1;do{var c=[0,2,4,6];c=c.randomize();do{if(h=!1,t=c.pop(),e=s+i.DIRS[8][t][0],r=a+i.DIRS[8][t][1],!(e<0||e>=this._options.cellWidth)&&!(r<0||r>=this._options.cellHeight)){if(n=this.rooms[s][a],n.connections.length>0&&n.connections[0][0]==e&&n.connections[0][1]==r)break;o=this.rooms[e][r],0==o.connections.length&&(o.connections.push([s,a]),this.connectedCells.push([e,r]),s=e,a=r,h=!0)}}while(c.length>0&&0==h)}while(c.length>0)},i.Map.Rogue.prototype._connectUnconnectedRooms=function(){var t=this._options.cellWidth,e=this._options.cellHeight;this.connectedCells=this.connectedCells.randomize();for(var r,n,o,s=0;s<this._options.cellWidth;s++)for(var a=0;a<this._options.cellHeight;a++)if(r=this.rooms[s][a],0==r.connections.length){var h=[0,2,4,6];h=h.randomize();var o=!1;do{var c=h.pop(),u=s+i.DIRS[8][c][0],l=a+i.DIRS[8][c][1];if(!(u<0||u>=t||l<0||l>=e)){if(n=this.rooms[u][l],o=!0,0==n.connections.length)break;for(var p=0;p<n.connections.length;p++)if(n.connections[p][0]==s&&n.connections[p][1]==a){o=!1;break}if(o)break}}while(h.length);o?r.connections.push([n.cellx,n.celly]):console.log("-- Unable to connect room.")}},i.Map.Rogue.prototype._createRandomRoomConnections=function(t){},i.Map.Rogue.prototype._createRooms=function(){for(var t,e,r,n,o,s=this._width,a=this._height,h=this._options.cellWidth,c=this._options.cellHeight,u=Math.floor(this._width/h),l=Math.floor(this._height/c),p=this._options.roomWidth,f=this._options.roomHeight,_=0;_<h;_++)for(var d=0;d<c;d++){if(r=u*_,n=l*d,0==r&&(r=1),0==n&&(n=1),t=i.RNG.getUniformInt(p[0],p[1]),e=i.RNG.getUniformInt(f[0],f[1]),d>0)for(o=this.rooms[_][d-1];n-(o.y+o.height)<3;)n++;if(_>0)for(o=this.rooms[_-1][d];r-(o.x+o.width)<3;)r++;for(var g=Math.round(i.RNG.getUniformInt(0,u-t)/2),y=Math.round(i.RNG.getUniformInt(0,l-e)/2);r+g+t>=s;)g?g--:t--;for(;n+y+e>=a;)y?y--:e--;r+=g,n+=y,this.rooms[_][d].x=r,this.rooms[_][d].y=n,this.rooms[_][d].width=t,this.rooms[_][d].height=e;for(var m=r;m<r+t;m++)for(var v=n;v<n+e;v++)this.map[m][v]=0}},i.Map.Rogue.prototype._getWallPosition=function(t,e){var r,n,o;return 1==e||3==e?(r=i.RNG.getUniformInt(t.x+1,t.x+t.width-2),1==e?(n=t.y-2,o=n+1):(n=t.y+t.height+1,o=n-1),this.map[r][o]=0):2!=e&&4!=e||(n=i.RNG.getUniformInt(t.y+1,t.y+t.height-2),2==e?(r=t.x+t.width+1,o=r-1):(r=t.x-2,o=r+1),this.map[o][n]=0),[r,n]},i.Map.Rogue.prototype._drawCorridore=function(t,e){var r,n,o,s,a=e[0]-t[0],h=e[1]-t[1],c=t[0],u=t[1],l=[],p=Math.abs(a),f=Math.abs(h),_=i.RNG.getUniform(),d=_,g=1-_;for(n=a>0?2:6,o=h>0?4:0,p<f?(r=Math.ceil(f*d),l.push([o,r]),l.push([n,p]),r=Math.floor(f*g),l.push([o,r])):(r=Math.ceil(p*d),l.push([n,r]),l.push([o,f]),r=Math.floor(p*g),l.push([n,r])),this.map[c][u]=0;l.length>0;)for(s=l.pop();s[1]>0;)c+=i.DIRS[8][s[0]][0],u+=i.DIRS[8][s[0]][1],this.map[c][u]=0,s[1]=s[1]-1},i.Map.Rogue.prototype._createCorridors=function(){for(var t,e,r,i,n,o=this._options.cellWidth,s=this._options.cellHeight,a=0;a<o;a++)for(var h=0;h<s;h++){t=this.rooms[a][h];for(var c=0;c<t.connections.length;c++)e=t.connections[c],r=this.rooms[e[0]][e[1]],r.cellx>t.cellx?(i=2,n=4):r.cellx<t.cellx?(i=4,n=2):r.celly>t.celly?(i=3,n=1):r.celly<t.celly&&(i=1,n=3),this._drawCorridore(this._getWallPosition(t,i),this._getWallPosition(r,n))}},i.Map.Feature=function(){},i.Map.Feature.prototype.isValid=function(t){},i.Map.Feature.prototype.create=function(t){},i.Map.Feature.prototype.debug=function(){},i.Map.Feature.createRandomAt=function(t,e,r,i,n){},i.Map.Feature.Room=function(t,e,r,i,n,o){this._x1=t,this._y1=e,this._x2=r,this._y2=i,this._doors={},arguments.length>4&&this.addDoor(n,o)},i.Map.Feature.Room.extend(i.Map.Feature),i.Map.Feature.Room.createRandomAt=function(t,e,r,n,o){var s=o.roomWidth[0],a=o.roomWidth[1],h=i.RNG.getUniformInt(s,a),s=o.roomHeight[0],a=o.roomHeight[1],c=i.RNG.getUniformInt(s,a);if(1==r){var u=e-Math.floor(i.RNG.getUniform()*c);return new this(t+1,u,t+h,u+c-1,t,e)}if(-1==r){var u=e-Math.floor(i.RNG.getUniform()*c);return new this(t-h,u,t-1,u+c-1,t,e)}if(1==n){var l=t-Math.floor(i.RNG.getUniform()*h);return new this(l,e+1,l+h-1,e+c,t,e)}if(-1==n){var l=t-Math.floor(i.RNG.getUniform()*h);return new this(l,e-c,l+h-1,e-1,t,e)}throw new Error("dx or dy must be 1 or -1")},i.Map.Feature.Room.createRandomCenter=function(t,e,r){var n=r.roomWidth[0],o=r.roomWidth[1],s=i.RNG.getUniformInt(n,o),n=r.roomHeight[0],o=r.roomHeight[1],a=i.RNG.getUniformInt(n,o),h=t-Math.floor(i.RNG.getUniform()*s),c=e-Math.floor(i.RNG.getUniform()*a);return new this(h,c,h+s-1,c+a-1)},i.Map.Feature.Room.createRandom=function(t,e,r){var n=r.roomWidth[0],o=r.roomWidth[1],s=i.RNG.getUniformInt(n,o),n=r.roomHeight[0],o=r.roomHeight[1],a=i.RNG.getUniformInt(n,o),h=t-s-1,c=e-a-1,u=1+Math.floor(i.RNG.getUniform()*h),l=1+Math.floor(i.RNG.getUniform()*c);return new this(u,l,u+s-1,l+a-1)},i.Map.Feature.Room.prototype.addDoor=function(t,e){return this._doors[t+","+e]=1,this},i.Map.Feature.Room.prototype.getDoors=function(t){for(var e in this._doors){var r=e.split(",");t(parseInt(r[0]),parseInt(r[1]))}return this},i.Map.Feature.Room.prototype.clearDoors=function(){return this._doors={},this},i.Map.Feature.Room.prototype.addDoors=function(t){for(var e=this._x1-1,r=this._x2+1,i=this._y1-1,n=this._y2+1,o=e;o<=r;o++)for(var s=i;s<=n;s++)o!=e&&o!=r&&s!=i&&s!=n||t(o,s)||this.addDoor(o,s);return this},i.Map.Feature.Room.prototype.debug=function(){console.log("room",this._x1,this._y1,this._x2,this._y2)},i.Map.Feature.Room.prototype.isValid=function(t,e){for(var r=this._x1-1,i=this._x2+1,n=this._y1-1,o=this._y2+1,s=r;s<=i;s++)for(var a=n;a<=o;a++)if(s==r||s==i||a==n||a==o){if(!t(s,a))return!1}else if(!e(s,a))return!1;return!0},i.Map.Feature.Room.prototype.create=function(t){for(var e=this._x1-1,r=this._x2+1,i=this._y1-1,n=this._y2+1,o=0,s=e;s<=r;s++)for(var a=i;a<=n;a++)o=s+","+a in this._doors?2:s==e||s==r||a==i||a==n?1:0,t(s,a,o)},i.Map.Feature.Room.prototype.getCenter=function(){return[Math.round((this._x1+this._x2)/2),Math.round((this._y1+this._y2)/2)]},i.Map.Feature.Room.prototype.getLeft=function(){return this._x1},i.Map.Feature.Room.prototype.getRight=function(){return this._x2},i.Map.Feature.Room.prototype.getTop=function(){return this._y1},i.Map.Feature.Room.prototype.getBottom=function(){return this._y2};i.Map.Feature.Corridor=function(t,e,r,i){this._startX=t,this._startY=e,this._endX=r,this._endY=i,this._endsWithAWall=!0},i.Map.Feature.Corridor.extend(i.Map.Feature),i.Map.Feature.Corridor.createRandomAt=function(t,e,r,n,o){var s=o.corridorLength[0],a=o.corridorLength[1],h=i.RNG.getUniformInt(s,a);return new this(t,e,t+r*h,e+n*h)},i.Map.Feature.Corridor.prototype.debug=function(){console.log("corridor",this._startX,this._startY,this._endX,this._endY)},i.Map.Feature.Corridor.prototype.isValid=function(t,e){var r=this._startX,i=this._startY,n=this._endX-r,o=this._endY-i,s=1+Math.max(Math.abs(n),Math.abs(o));n&&(n/=Math.abs(n)),o&&(o/=Math.abs(o));for(var a=o,h=-n,c=!0,u=0;u<s;u++){var l=r+u*n,p=i+u*o;if(e(l,p)||(c=!1),t(l+a,p+h)||(c=!1),t(l-a,p-h)||(c=!1),!c){s=u,this._endX=l-n,this._endY=p-o;break}}if(0==s)return!1;if(1==s&&t(this._endX+n,this._endY+o))return!1;var f=!t(this._endX+n+a,this._endY+o+h),_=!t(this._endX+n-a,this._endY+o-h);return this._endsWithAWall=t(this._endX+n,this._endY+o),!f&&!_||!this._endsWithAWall},i.Map.Feature.Corridor.prototype.create=function(t){var e=this._startX,r=this._startY,i=this._endX-e,n=this._endY-r,o=1+Math.max(Math.abs(i),Math.abs(n));i&&(i/=Math.abs(i)),n&&(n/=Math.abs(n));for(var s=0;s<o;s++){t(e+s*i,r+s*n,0)}return!0},i.Map.Feature.Corridor.prototype.createPriorityWalls=function(t){if(this._endsWithAWall){var e=this._startX,r=this._startY,i=this._endX-e,n=this._endY-r;i&&(i/=Math.abs(i)),n&&(n/=Math.abs(n));var o=n,s=-i;t(this._endX+i,this._endY+n),t(this._endX+o,this._endY+s),t(this._endX-o,this._endY-s)}},i.Noise=function(){},i.Noise.prototype.get=function(t,e){},i.Noise.Simplex=function(t){i.Noise.call(this),this._F2=.5*(Math.sqrt(3)-1),this._G2=(3-Math.sqrt(3))/6,this._gradients=[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]];for(var e=[],r=t||256,n=0;n<r;n++)e.push(n);e=e.randomize(),this._perms=[],this._indexes=[];for(var n=0;n<2*r;n++)this._perms.push(e[n%r]),this._indexes.push(this._perms[n]%this._gradients.length)},i.Noise.Simplex.extend(i.Noise),i.Noise.Simplex.prototype.get=function(t,e){var r,i,n,o=this._perms,s=this._indexes,a=o.length/2,h=this._G2,c=0,u=0,l=0,p=(t+e)*this._F2,f=Math.floor(t+p),_=Math.floor(e+p),d=(f+_)*h,g=f-d,y=_-d,m=t-g,v=e-y;m>v?(i=1,n=0):(i=0,n=1);var b=m-i+h,w=v-n+h,x=m-1+2*h,M=v-1+2*h,T=f.mod(a),k=_.mod(a),S=.5-m*m-v*v;if(S>=0){S*=S,r=s[T+o[k]];var R=this._gradients[r];c=S*S*(R[0]*m+R[1]*v)}var E=.5-b*b-w*w;if(E>=0){E*=E,r=s[T+i+o[k+n]];var R=this._gradients[r];u=E*E*(R[0]*b+R[1]*w)}var A=.5-x*x-M*M;if(A>=0){A*=A,r=s[T+1+o[k+1]];var R=this._gradients[r];l=A*A*(R[0]*x+R[1]*M)}return 70*(c+u+l)},i.FOV=function(t,e){this._lightPasses=t,this._options={topology:8};for(var r in e)this._options[r]=e[r]},i.FOV.prototype.compute=function(t,e,r,i){},i.FOV.prototype._getCircle=function(t,e,r){var n,o,s,a=[];switch(this._options.topology){case 4:o=1,s=[0,1],n=[i.DIRS[8][7],i.DIRS[8][1],i.DIRS[8][3],i.DIRS[8][5]];break;case 6:n=i.DIRS[6],o=1,s=[-1,1];break;case 8:n=i.DIRS[4],o=2,s=[-1,1]}for(var h=t+s[0]*r,c=e+s[1]*r,u=0;u<n.length;u++)for(var l=0;l<r*o;l++)a.push([h,c]),h+=n[u][0],c+=n[u][1];return a},i.FOV.DiscreteShadowcasting=function(t,e){i.FOV.call(this,t,e)},i.FOV.DiscreteShadowcasting.extend(i.FOV),i.FOV.DiscreteShadowcasting.prototype.compute=function(t,e,r,i){this._coords,this._map;if(i(t,e,0,1),this._lightPasses(t,e))for(var n,o,s,a,h,c=[],u=1;u<=r;u++)for(var l=this._getCircle(t,e,u),p=360/l.length,f=0;f<l.length;f++)if(s=l[f][0],a=l[f][1],n=p*(f-.5),o=n+p,h=!this._lightPasses(s,a),this._visibleCoords(Math.floor(n),Math.ceil(o),h,c)&&i(s,a,u,1),2==c.length&&0==c[0]&&360==c[1])return},i.FOV.DiscreteShadowcasting.prototype._visibleCoords=function(t,e,r,i){if(t<0){var n=arguments.callee(0,e,r,i),o=arguments.callee(360+t,360,r,i);return n||o}for(var s=0;s<i.length&&i[s]<t;)s++;if(s==i.length)return r&&i.push(t,e),!0;var a=0;if(s%2){for(;s<i.length&&i[s]<e;)s++,a++;return 0!=a&&(r&&(a%2?i.splice(s-a,a,e):i.splice(s-a,a)),!0)}for(;s<i.length&&i[s]<e;)s++,a++;return(t!=i[s-a]||1!=a)&&(r&&(a%2?i.splice(s-a,a,t):i.splice(s-a,a,t,e)),!0)},i.FOV.PreciseShadowcasting=function(t,e){i.FOV.call(this,t,e)},i.FOV.PreciseShadowcasting.extend(i.FOV),i.FOV.PreciseShadowcasting.prototype.compute=function(t,e,r,i){if(i(t,e,0,1),this._lightPasses(t,e))for(var n,o,s,a,h,c,u=[],l=1;l<=r;l++)for(var p=this._getCircle(t,e,l),f=p.length,_=0;_<f;_++)if(n=p[_][0],o=p[_][1],a=[_?2*_-1:2*f-1,2*f],h=[2*_+1,2*f],s=!this._lightPasses(n,o),c=this._checkVisibility(a,h,s,u),c&&i(n,o,l,c),2==u.length&&0==u[0][0]&&u[1][0]==u[1][1])return},i.FOV.PreciseShadowcasting.prototype._checkVisibility=function(t,e,r,i){if(t[0]>e[0]){return(this._checkVisibility(t,[t[1],t[1]],r,i)+this._checkVisibility([0,1],e,r,i))/2}for(var n=0,o=!1;n<i.length;){var s=i[n],a=s[0]*t[1]-t[0]*s[1];if(a>=0){0!=a||n%2||(o=!0);break}n++}for(var h=i.length,c=!1;h--;){var s=i[h],a=e[0]*s[1]-s[0]*e[1];if(a>=0){0==a&&h%2&&(c=!0);break}}var u=!0;if(n==h&&(o||c)?u=!1:o&&c&&n+1==h&&h%2?u=!1:n>h&&n%2&&(u=!1),!u)return 0;var l,p,f=h-n+1;if(f%2)if(n%2){var p=i[n];l=(e[0]*p[1]-p[0]*e[1])/(p[1]*e[1]),r&&i.splice(n,f,e)}else{var p=i[h];l=(p[0]*t[1]-t[0]*p[1])/(t[1]*p[1]),r&&i.splice(n,f,t)}else{if(!(n%2))return r&&i.splice(n,f,t,e),1;var _=i[n],d=i[h];l=(d[0]*_[1]-_[0]*d[1])/(_[1]*d[1]),r&&i.splice(n,f)}return l/((e[0]*t[1]-t[0]*e[1])/(t[1]*e[1]))},i.FOV.RecursiveShadowcasting=function(t,e){i.FOV.call(this,t,e)},i.FOV.RecursiveShadowcasting.extend(i.FOV),i.FOV.RecursiveShadowcasting.OCTANTS=[[-1,0,0,1],[0,-1,1,0],[0,-1,-1,0],[-1,0,0,-1],[1,0,0,-1],[0,1,-1,0],[0,1,1,0],[1,0,0,1]],i.FOV.RecursiveShadowcasting.prototype.compute=function(t,e,r,n){n(t,e,0,1);for(var o=0;o<i.FOV.RecursiveShadowcasting.OCTANTS.length;o++)this._renderOctant(t,e,i.FOV.RecursiveShadowcasting.OCTANTS[o],r,n)},i.FOV.RecursiveShadowcasting.prototype.compute180=function(t,e,r,n,o){o(t,e,0,1);var s=(n-1+8)%8,a=(n-2+8)%8,h=(n+1+8)%8;this._renderOctant(t,e,i.FOV.RecursiveShadowcasting.OCTANTS[a],r,o),this._renderOctant(t,e,i.FOV.RecursiveShadowcasting.OCTANTS[s],r,o),this._renderOctant(t,e,i.FOV.RecursiveShadowcasting.OCTANTS[n],r,o),this._renderOctant(t,e,i.FOV.RecursiveShadowcasting.OCTANTS[h],r,o)},i.FOV.RecursiveShadowcasting.prototype.compute90=function(t,e,r,n,o){o(t,e,0,1);var s=(n-1+8)%8;this._renderOctant(t,e,i.FOV.RecursiveShadowcasting.OCTANTS[n],r,o),this._renderOctant(t,e,i.FOV.RecursiveShadowcasting.OCTANTS[s],r,o)},i.FOV.RecursiveShadowcasting.prototype._renderOctant=function(t,e,r,i,n){this._castVisibility(t,e,1,1,0,i+1,r[0],r[1],r[2],r[3],n)},i.FOV.RecursiveShadowcasting.prototype._castVisibility=function(t,e,r,i,n,o,s,a,h,c,u){if(!(i<n))for(var l=r;l<=o;l++){for(var p=-l-1,f=-l,_=!1,d=0;p<=0;){p+=1;var g=t+p*s+f*a,y=e+p*h+f*c,m=(p-.5)/(f+.5),v=(p+.5)/(f-.5);if(!(v>i)){if(m<n)break;if(p*p+f*f<o*o&&u(g,y,l,1),_){if(!this._lightPasses(g,y)){d=v;continue}_=!1,i=d}else!this._lightPasses(g,y)&&l<o&&(_=!0,this._castVisibility(t,e,l+1,i,m,o,s,a,h,c,u),d=v)}}if(_)break}},i.Color={fromString:function(t){var e,r;if(t in this._cache)e=this._cache[t];else{if("#"==t.charAt(0)){var i=t.match(/[0-9a-f]/gi).map(function(t){return parseInt(t,16)});if(3==i.length)e=i.map(function(t){return 17*t});else{for(var n=0;n<3;n++)i[n+1]+=16*i[n],i.splice(n,1);e=i}}else e=(r=t.match(/rgb\(([0-9, ]+)\)/i))?r[1].split(/\s*,\s*/).map(function(t){return parseInt(t)}):[0,0,0];this._cache[t]=e}return e.slice()},add:function(t,e){for(var r=t.slice(),i=0;i<3;i++)for(var n=1;n<arguments.length;n++)r[i]+=arguments[n][i];return r},add_:function(t,e){for(var r=0;r<3;r++)for(var i=1;i<arguments.length;i++)t[r]+=arguments[i][r];return t},multiply:function(t,e){for(var r=t.slice(),i=0;i<3;i++){for(var n=1;n<arguments.length;n++)r[i]*=arguments[n][i]/255;r[i]=Math.round(r[i])}return r},multiply_:function(t,e){for(var r=0;r<3;r++){for(var i=1;i<arguments.length;i++)t[r]*=arguments[i][r]/255;t[r]=Math.round(t[r])}return t},interpolate:function(t,e,r){arguments.length<3&&(r=.5);for(var i=t.slice(),n=0;n<3;n++)i[n]=Math.round(i[n]+r*(e[n]-t[n]));return i},interpolateHSL:function(t,e,r){arguments.length<3&&(r=.5);for(var i=this.rgb2hsl(t),n=this.rgb2hsl(e),o=0;o<3;o++)i[o]+=r*(n[o]-i[o]);return this.hsl2rgb(i)},randomize:function(t,e){e instanceof Array||(e=Math.round(i.RNG.getNormal(0,e)));for(var r=t.slice(),n=0;n<3;n++)r[n]+=e instanceof Array?Math.round(i.RNG.getNormal(0,e[n])):e;return r},rgb2hsl:function(t){var e,r,i=t[0]/255,n=t[1]/255,o=t[2]/255,s=Math.max(i,n,o),a=Math.min(i,n,o),h=(s+a)/2;if(s==a)e=r=0;else{var c=s-a;switch(r=h>.5?c/(2-s-a):c/(s+a),s){case i:e=(n-o)/c+(n<o?6:0);break;case n:e=(o-i)/c+2;break;case o:e=(i-n)/c+4}e/=6}return[e,r,h]},hsl2rgb:function(t){var e=t[2];if(0==t[1])return e=Math.round(255*e),[e,e,e];var r=function(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+(e-t)*(2/3-r)*6:t},i=t[1],n=e<.5?e*(1+i):e+i-e*i,o=2*e-n,s=r(o,n,t[0]+1/3),a=r(o,n,t[0]),h=r(o,n,t[0]-1/3);return[Math.round(255*s),Math.round(255*a),Math.round(255*h)]},toRGB:function(t){return"rgb("+this._clamp(t[0])+","+this._clamp(t[1])+","+this._clamp(t[2])+")"},toHex:function(t){for(var e=[],r=0;r<3;r++)e.push(this._clamp(t[r]).toString(16).lpad("0",2));return"#"+e.join("")},_clamp:function(t){return t<0?0:t>255?255:t},_cache:{black:[0,0,0],navy:[0,0,128],darkblue:[0,0,139],mediumblue:[0,0,205],blue:[0,0,255],darkgreen:[0,100,0],green:[0,128,0],teal:[0,128,128],darkcyan:[0,139,139],deepskyblue:[0,191,255],darkturquoise:[0,206,209],mediumspringgreen:[0,250,154],lime:[0,255,0],springgreen:[0,255,127],aqua:[0,255,255],cyan:[0,255,255],midnightblue:[25,25,112],dodgerblue:[30,144,255],forestgreen:[34,139,34],seagreen:[46,139,87],darkslategray:[47,79,79],darkslategrey:[47,79,79],limegreen:[50,205,50],mediumseagreen:[60,179,113],turquoise:[64,224,208],royalblue:[65,105,225],steelblue:[70,130,180],darkslateblue:[72,61,139],mediumturquoise:[72,209,204],indigo:[75,0,130],darkolivegreen:[85,107,47],cadetblue:[95,158,160],cornflowerblue:[100,149,237],mediumaquamarine:[102,205,170],dimgray:[105,105,105],dimgrey:[105,105,105],slateblue:[106,90,205],olivedrab:[107,142,35],slategray:[112,128,144],slategrey:[112,128,144],lightslategray:[119,136,153],lightslategrey:[119,136,153],mediumslateblue:[123,104,238],lawngreen:[124,252,0],chartreuse:[127,255,0],aquamarine:[127,255,212],maroon:[128,0,0],purple:[128,0,128],olive:[128,128,0],gray:[128,128,128],grey:[128,128,128],skyblue:[135,206,235],lightskyblue:[135,206,250],blueviolet:[138,43,226],darkred:[139,0,0],darkmagenta:[139,0,139],saddlebrown:[139,69,19],darkseagreen:[143,188,143],lightgreen:[144,238,144],mediumpurple:[147,112,216],darkviolet:[148,0,211],palegreen:[152,251,152],darkorchid:[153,50,204],yellowgreen:[154,205,50],sienna:[160,82,45],brown:[165,42,42],darkgray:[169,169,169],darkgrey:[169,169,169],lightblue:[173,216,230],greenyellow:[173,255,47],paleturquoise:[175,238,238],lightsteelblue:[176,196,222],powderblue:[176,224,230],firebrick:[178,34,34],darkgoldenrod:[184,134,11],mediumorchid:[186,85,211],rosybrown:[188,143,143],darkkhaki:[189,183,107],silver:[192,192,192],mediumvioletred:[199,21,133],indianred:[205,92,92],peru:[205,133,63],chocolate:[210,105,30],tan:[210,180,140],lightgray:[211,211,211],lightgrey:[211,211,211],palevioletred:[216,112,147],thistle:[216,191,216],orchid:[218,112,214],goldenrod:[218,165,32],crimson:[220,20,60],gainsboro:[220,220,220],plum:[221,160,221],burlywood:[222,184,135],lightcyan:[224,255,255],lavender:[230,230,250],darksalmon:[233,150,122],violet:[238,130,238],palegoldenrod:[238,232,170],lightcoral:[240,128,128],khaki:[240,230,140],aliceblue:[240,248,255],honeydew:[240,255,240],azure:[240,255,255],sandybrown:[244,164,96],wheat:[245,222,179],beige:[245,245,220],whitesmoke:[245,245,245],mintcream:[245,255,250],ghostwhite:[248,248,255],salmon:[250,128,114],antiquewhite:[250,235,215],linen:[250,240,230],lightgoldenrodyellow:[250,250,210],oldlace:[253,245,230],red:[255,0,0],fuchsia:[255,0,255],magenta:[255,0,255],deeppink:[255,20,147],orangered:[255,69,0],tomato:[255,99,71],hotpink:[255,105,180],coral:[255,127,80],darkorange:[255,140,0],lightsalmon:[255,160,122],orange:[255,165,0],lightpink:[255,182,193],pink:[255,192,203],gold:[255,215,0],peachpuff:[255,218,185],navajowhite:[255,222,173],moccasin:[255,228,181],bisque:[255,228,196],mistyrose:[255,228,225],blanchedalmond:[255,235,205],papayawhip:[255,239,213],lavenderblush:[255,240,245],seashell:[255,245,238],cornsilk:[255,248,220],lemonchiffon:[255,250,205],floralwhite:[255,250,240],snow:[255,250,250],yellow:[255,255,0],lightyellow:[255,255,224],ivory:[255,255,240],white:[255,255,255]}},i.Lighting=function(t,e){this._reflectivityCallback=t,this._options={passes:1,emissionThreshold:100,range:10},this._fov=null,this._lights={},this._reflectivityCache={},this._fovCache={},this.setOptions(e)},i.Lighting.prototype.setOptions=function(t){for(var e in t)this._options[e]=t[e];return t&&t.range&&this.reset(),this},i.Lighting.prototype.setFOV=function(t){return this._fov=t,this._fovCache={},this},i.Lighting.prototype.setLight=function(t,e,r){var n=t+","+e;return r?this._lights[n]="string"==typeof r?i.Color.fromString(r):r:delete this._lights[n],this},i.Lighting.prototype.clearLights=function(){this._lights={}},i.Lighting.prototype.reset=function(){return this._reflectivityCache={},this._fovCache={},this},i.Lighting.prototype.compute=function(t){var e={},r={},n={};for(var o in this._lights){var s=this._lights[o];r[o]=[0,0,0],i.Color.add_(r[o],s)}for(var a=0;a<this._options.passes;a++)this._emitLight(r,n,e),a+1!=this._options.passes&&(r=this._computeEmitters(n,e));for(var h in n){var c=h.split(",");t(parseInt(c[0]),parseInt(c[1]),n[h])}return this},i.Lighting.prototype._emitLight=function(t,e,r){for(var i in t){var n=i.split(","),o=parseInt(n[0]),s=parseInt(n[1]);this._emitLightFromCell(o,s,t[i],e),r[i]=1}return this},i.Lighting.prototype._computeEmitters=function(t,e){var r={};for(var i in t)if(!(i in e)){var n=t[i];if(i in this._reflectivityCache)var o=this._reflectivityCache[i];else{var s=i.split(","),a=parseInt(s[0]),h=parseInt(s[1]),o=this._reflectivityCallback(a,h);this._reflectivityCache[i]=o}if(0!=o){for(var c=[],u=0,l=0;l<3;l++){var p=Math.round(n[l]*o);c[l]=p,u+=p}u>this._options.emissionThreshold&&(r[i]=c)}}return r},i.Lighting.prototype._emitLightFromCell=function(t,e,r,i){var n=t+","+e;if(n in this._fovCache)var o=this._fovCache[n];else var o=this._updateFOV(t,e);for(var s in o){var a=o[s];if(s in i)var h=i[s];else{var h=[0,0,0];i[s]=h}for(var c=0;c<3;c++)h[c]+=Math.round(r[c]*a)}return this},i.Lighting.prototype._updateFOV=function(t,e){var r=t+","+e,i={};this._fovCache[r]=i;var n=this._options.range,o=function(t,e,r,o){var s=t+","+e,a=o*(1-r/n);0!=a&&(i[s]=a)};return this._fov.compute(t,e,n,o.bind(this)),i},i.Path=function(t,e,r,n){this._toX=t,this._toY=e,this._fromX=null,this._fromY=null,this._passableCallback=r,this._options={topology:8};for(var o in n)this._options[o]=n[o];this._dirs=i.DIRS[this._options.topology],8==this._options.topology&&(this._dirs=[this._dirs[0],this._dirs[2],this._dirs[4],this._dirs[6],this._dirs[1],this._dirs[3],this._dirs[5],this._dirs[7]])},i.Path.prototype.compute=function(t,e,r){},i.Path.prototype._getNeighbors=function(t,e){for(var r=[],i=0;i<this._dirs.length;i++){var n=this._dirs[i],o=t+n[0],s=e+n[1];this._passableCallback(o,s)&&r.push([o,s])}return r},i.Path.Dijkstra=function(t,e,r,n){i.Path.call(this,t,e,r,n),this._computed={},this._todo=[],this._add(t,e,null)},i.Path.Dijkstra.extend(i.Path),i.Path.Dijkstra.prototype.compute=function(t,e,r){var i=t+","+e;if(i in this._computed||this._compute(t,e),i in this._computed)for(var n=this._computed[i];n;)r(n.x,n.y),n=n.prev},i.Path.Dijkstra.prototype._compute=function(t,e){for(;this._todo.length;){var r=this._todo.shift();if(r.x==t&&r.y==e)return;for(var i=this._getNeighbors(r.x,r.y),n=0;n<i.length;n++){var o=i[n],s=o[0],a=o[1];s+","+a in this._computed||this._add(s,a,r)}}},i.Path.Dijkstra.prototype._add=function(t,e,r){var i={x:t,y:e,prev:r};this._computed[t+","+e]=i,this._todo.push(i)},i.Path.AStar=function(t,e,r,n){i.Path.call(this,t,e,r,n),this._todo=[],this._done={},this._fromX=null,this._fromY=null},i.Path.AStar.extend(i.Path),i.Path.AStar.prototype.compute=function(t,e,r){for(this._todo=[],this._done={},this._fromX=t,this._fromY=e,this._add(this._toX,this._toY,null);this._todo.length;){var i=this._todo.shift();if(i.x==t&&i.y==e)break;for(var n=this._getNeighbors(i.x,i.y),o=0;o<n.length;o++){var s=n[o],a=s[0],h=s[1];a+","+h in this._done||this._add(a,h,i)}}var i=this._done[t+","+e];if(i)for(;i;)r(i.x,i.y),i=i.prev},i.Path.AStar.prototype._add=function(t,e,r){var i={x:t,y:e,prev:r,g:r?r.g+1:0,h:this._distance(t,e)};this._done[t+","+e]=i;for(var n=i.g+i.h,o=0;o<this._todo.length;o++){var s=this._todo[o];if(n<s.g+s.h)return void this._todo.splice(o,0,i)}this._todo.push(i)},i.Path.AStar.prototype._distance=function(t,e){switch(this._options.topology){case 4:return Math.abs(t-this._fromX)+Math.abs(e-this._fromY);case 6:var r=Math.abs(t-this._fromX),i=Math.abs(e-this._fromY);return i+Math.max(0,(r-i)/2);case 8:return Math.max(Math.abs(t-this._fromX),Math.abs(e-this._fromY))}throw new Error("Illegal topology")},i.Display.Term=function(t){i.Display.Backend.call(this,t),this._cx=-1,this._cy=-1,this._lastColor="",this._options={},this._ox=0,this._oy=0,this._termcolor={}},i.Display.Term.extend(i.Display.Backend),i.Display.Term.prototype.compute=function(t){this._options=t,this._ox=Math.floor((r.stdout.columns-t.width)/2),this._oy=Math.floor((r.stdout.rows-t.height)/2),this._termcolor=new(i.Display.Term[t.termColor.capitalize()])(this._context),this._context._termcolor=this._termcolor},i.Display.Term.prototype.draw=function(t,e){var i=t[0],n=t[1],o=t[2],s=t[3],a=t[4],h=this._ox+i,c=this._oy+n;if(!(h<0||h>=r.stdout.columns)&&!(c<0||c>=r.stdout.rows)&&(h===this._cx&&c===this._cy||(r.stdout.write(this._termcolor.positionToAnsi(h,c)),this._cx=h,this._cy=c),e&&(o||(o=" ")),o)){var u=this._termcolor.colorToAnsi(s,a);u!==this._lastColor&&(r.stdout.write(u),this._lastColor=u);var l=[].concat(o);r.stdout.write(l[0]),this._cx++,this._cx>=r.stdout.columns&&(this._cx=0,this._cy++)}},i.Display.Term.prototype.computeSize=function(t,e){return[r.stdout.columns,r.stdout.rows]},i.Display.Term.prototype.computeFontSize=function(t,e){return 12},i.Display.Term.prototype.eventToPosition=function(t,e){return[t,e]},i.Display.Term.Color=function(t){this._context=t},i.Display.Term.Color.prototype.clearToAnsi=function(t){},i.Display.Term.Color.prototype.colorToAnsi=function(t,e){},i.Display.Term.Color.prototype.positionToAnsi=function(t,e){},i.Display.Term.Xterm=function(t){i.Display.Term.Color.call(this,t)},i.Display.Term.Xterm.extend(i.Display.Term.Color),i.Display.Term.Xterm.prototype.clearToAnsi=function(t){return"[0;48;5;"+this._termcolor(t)+"m[2J"},i.Display.Term.Xterm.prototype.colorToAnsi=function(t,e){return"[0;38;5;"+this._termcolor(t)+";48;5;"+this._termcolor(e)+"m"},i.Display.Term.Xterm.prototype.positionToAnsi=function(t,e){return"["+(e+1)+";"+(t+1)+"H"},i.Display.Term.Xterm.prototype._termcolor=function(t){var e=i.Color.fromString(t);return 36*Math.floor(e[0]*(6/256))+6*Math.floor(e[1]*(6/256))+1*Math.floor(e[2]*(6/256))+16};for(var n in i)e[n]=i[n]}).call(e,r(12),r(21))},function(t,e,r){"use strict";r.d(e,"a",function(){return i}),r.d(e,"b",function(){return n}),r.d(e,"c",function(){return o});var i={width:80,height:26},n={width:160,height:50},o={null:{},floor:{chr:".",foreground:"#444",background:"#222",isWalkable:!0},wall:{chr:"#",foreground:"#777",background:"#2e2e2e",isDiggable:!0},door:{chr:"+",foreground:"yellow",background:"#222",bump:function(){this.isWalkable||(this.isWalkable=!0,this.chr="/")}}}},function(t,e,r){"use strict";r.d(e,"a",function(){return n}),r.d(e,"b",function(){return o}),r.d(e,"c",function(){return s});var i=r(7),n={chr:"@",foreground:"white",background:"black",maxHp:40,attackValue:"2d6",mixins:[i.a.Moveable,i.a.PlayerActor,i.a.Attacker,i.a.Destructible,i.a.MessageRecipient]},o={chr:"F",foreground:"green",name:"fungus",maxHp:10,mixins:[i.a.FungusActor,i.a.Destructible]},s={chr:"",foreground:"red",name:"most evil creature in the world",maxHp:20,attackValue:"3d3",mixins:[i.a.Moveable,i.a.EnemyActor,i.a.Attacker,i.a.Destructible]}},function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}function o(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=r(6),a="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),c=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,e);var r=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));r.name=t.name||"",r.xy=t.xy||0,r.map=null,r.attachedMixins={},r.attachedMixinGroups={};for(var o=t.mixins||[],s=0;s<o.length;s++){for(var a in o[s])"init"===a||"name"===a||r.hasOwnProperty(a)||(r[a]=o[s][a]);r.attachedMixins[o[s].name]=!0,o[s].groupName&&(r.attachedMixinGroups[o[s].groupName]=!0),o[s].init&&o[s].init.call(r,t)}return r}return o(e,t),h(e,[{key:"hasMixin",value:function(t){return"object"===("undefined"===typeof t?"undefined":a(t))?this.attachedMixins[t.name]:this.attachedMixins[t]||this.attachedMixinGroups[t]}}]),e}(s.a);e.a=c},function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var n=r(0),o=r.n(n),s=r(8),a=r(1),h=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),c=function(){function t(){i(this,t),this.currentScreen=null}return h(t,[{key:"init",value:function(){var t=this;this.display=new o.a.Display(a.a),document.body.appendChild(this.display.getContainer());!function(e){window.addEventListener(e,function(r){null!==t.currentScreen&&t.currentScreen.handleInput(e,r)})}("keydown"),this.switchScreen(s.a.startScreen)}},{key:"switchScreen",value:function(t){null!==this.currentScreen&&this.currentScreen.exit(),this.display.clear(),this.currentScreen=t,this.currentScreen&&(this.currentScreen.enter(),this.refresh())}},{key:"refresh",value:function(){this.display.clear(),this.currentScreen.render(this.display)}}]),t}(),u=new c;e.a=u},function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),o=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;i(this,t),this.x=e,this.y=r}return n(t,[{key:"toString",value:function(){return this.x+","+this.y}},{key:"is",value:function(t){return this.x===t.x&&this.y===t.y}},{key:"dist8",value:function(t){var e=t.x-this.x,r=t.y-this.y;return Math.max(Math.abs(e),Math.abs(r))}},{key:"dist4",value:function(t){var e=t.x-this.x,r=t.y-this.y;return Math.abs(e)+Math.abs(r)}},{key:"dist",value:function(t){var e=t.x-this.x,r=t.y-this.y;return Math.sqrt(e*e+r*r)}},{key:"plus",value:function(e){return new t(this.x+e.x,this.y+e.y)}},{key:"minus",value:function(e){return new t(this.x-e.x,this.y-e.y)}}]),t}();e.a=o},function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var n=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,t),this.chr=e.chr||"",this.foreground=e.foreground||"#ccc",this.background=e.background||null};e.a=n},function(t,e,r){"use strict";var i=r(0),n=r.n(i),o=r(5),s=r(4),a=r(3),h=r(2),c=(r(8),r(19)),u=r.n(c),l=r(18),p={};p.Moveable={name:"Moveable",tryMove:function(t,e){var r=e.getTile(t),i=e.getEntityAt(t);if(i)return!!this.hasMixin("Attacker")&&(this.attack(i),!0);if(r.isWalkable)return this.xy=t,!0;if(r.isBumpable)r.bump();else if(r.isDiggable)return e.dig(t),!0;return!1}},p.Destructible={name:"Destructible",init:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{maxHp:10,defenseValue:0};this.maxHp=t.maxHp||10,this.hp=t.hp||this.maxHp,this.defenseValue=t.defenseValue||0},takeDamage:function(t,e){this.hp-=e,this.hp<=0&&(r.i(l.a)(t,"You kill the %s!",[this.name]),r.i(l.a)(this,"You die!"),this.hasMixin("PlayerActor")&&this.map.engine.lock(),this.map.removeEntity(this))}},p.SimpleAttacker={name:"SimpleAttacker",groupName:"Attacker",attack:function(t){t.hasMixin("Destructible")&&t.takeDamage(this,1)}},p.Attacker={name:"Attacker",groupName:"Attacker",init:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{attackValue:"1d1"};this.attackValue=t.attackValue||"1d1"},attack:function(t){if(t.hasMixin("Destructible")){var e=Math.max(0,u.a.roll(this.attackValue)-t.defenseValue);r.i(l.a)(this,"You strike the %s for %d damage!",[t.name,e]),r.i(l.a)(t,"The %s strikes you for %d damage!",[this.name,e]),t.takeDamage(this,e)}}},p.PlayerActor={name:"PlayerActor",groupName:"Actor",act:function(){s.a.refresh(),this.map.engine.lock(),this.clearMessages()}},p.FungusActor={name:"FungusActor",groupName:"Actor",init:function(){this.growthsRemaining=5,this.lifeTurns=1e3},act:function(){if(this.lifeTurns--,100===this.lifeTurns&&(this.foreground="goldenrod"),this.lifeTurns<=0&&this.map.removeEntity(this),!(this.growthsRemaining<=0||Math.random()>.02)){var t=new o.a(Math.floor(3*Math.random())-1,Math.floor(3*Math.random())-1);if(!t.is(new o.a)){var e=this.xy.plus(t);if(this.map.isEmptyFloor(e)){var i=new a.a(h.b);i.xy=e,this.map.addEntity(i),this.growthsRemaining--,r.i(l.b)(this.map,i.xy,"The fungus is spreading!")}}}}},p.EnemyActor={name:"EnemyActor",groupName:"Actor",act:function(){var t=this;if(this.map.entities[0]){var e=this.map.entities[0].xy.x,r=this.map.entities[0].xy.y,i=function(e,r){return t.map.getTile(new o.a(e,r)).isWalkable},s=new n.a.Path.AStar(e,r,i),a=[],h=function(t,e){return a.push(new o.a(t,e))};s.compute(this.xy.x,this.xy.y,h),"undefined"!==typeof a[1]&&(e=a[1].x,r=a[1].y,this.tryMove(new o.a(e,r),this.map))}}},p.Teleportable={name:"Teleportable",teleport:function(t){return this.xy=t.getRandomFloorTile(),!0}},p.MessageRecipient={name:"MessageRecipient",init:function(t){this.messages=[]},receiveMessage:function(t){this.messages.push(t)},clearMessages:function(){this.messages=[]}},e.a=p},function(t,e,r){"use strict";var i=r(0),n=r.n(i),o=r(4),s=r(17),a=r(1),h=r(5),c=r(3),u=r(2),l=r(11),p=r.n(l),f=this,_=p.a.vsprintf,d=(p.a.sprintf,{});d.startScreen={enter:function(){console.log("Entered start screen.")},exit:function(){console.log("Exited start screen.")},render:function(t){t.drawText(1,1,"%c{yellow}Javascript Roguelike"),t.drawText(1,2,"Press [Enter] to start!")},handleInput:function(t,e){"keydown"===t&&e.keyCode===n.a.VK_RETURN&&o.a.switchScreen(d.playScreen)}},d.playScreen={map:null,player:null,enter:function(){f.keys={},f.keys[n.a.VK_K]=0,f.keys[n.a.VK_UP]=0,f.keys[n.a.VK_NUMPAD8]=0,f.keys[n.a.VK_U]=1,f.keys[n.a.VK_NUMPAD9]=1,f.keys[n.a.VK_PAGE_UP]=1,f.keys[n.a.VK_L]=2,f.keys[n.a.VK_RIGHT]=2,f.keys[n.a.VK_NUMPAD6]=2,f.keys[n.a.VK_N]=3,f.keys[n.a.VK_NUMPAD3]=3,f.keys[n.a.VK_PAGE_DOWN]=3,f.keys[n.a.VK_J]=4,f.keys[n.a.VK_DOWN]=4,f.keys[n.a.VK_NUMPAD2]=4,f.keys[n.a.VK_B]=5,f.keys[n.a.VK_NUMPAD1]=5,f.keys[n.a.VK_END]=5,f.keys[n.a.VK_H]=6,f.keys[n.a.VK_LEFT]=6,f.keys[n.a.VK_NUMPAD4]=6,f.keys[n.a.VK_Y]=7,f.keys[n.a.VK_NUMPAD7]=7,f.keys[n.a.VK_HOME]=7,f.keys[n.a.VK_PERIOD]=-1,f.keys[n.a.VK_CLEAR]=-1,f.keys[n.a.VK_NUMPAD5]=-1,f.move=function(t){var e=f.player.xy.plus(t);f.player.tryMove(e,f.map)},f.player=new c.a(u.a),f.map=r.i(s.a)(f.player),f.map.engine.start(),console.log("Entered play screen.")},exit:function(){console.log("Exited play screen.")},render:function(t){var e=a.a.width,r=a.a.height,i=Math.max(0,f.player.xy.x-e/2);i=Math.floor(Math.min(i,f.map.width-e));var n=Math.max(0,f.player.xy.y-r/2);n=Math.floor(Math.min(n,f.map.height-r));for(var o=i;o<i+e;o++)for(var s=n;s<n+r;s++){var c=f.map.getTile(new h.a(o,s));t.draw(o-i,s-n,c.chr,c.foreground,c.background)}for(var u=f.map.entities,l=0;l<u.length;l++){var p=u[l];if(p.xy.x>=i&&p.xy.y>=n&&p.xy.x<i+e&&p.xy.y<n+r){t.draw(p.xy.x-i,p.xy.y-n,p.chr,p.foreground,p.background);for(var d=f.player.messages,g=0;g<d.length;g++)t.drawText(0,g,d[g]);var y=_("HP: %d/%d ",[f.player.hp,f.player.maxHp]);t.drawText(0,a.a.height-1,y)}}},handleInput:function(t,e){if("keydown"===t)if(e.keyCode===n.a.VK_RETURN)o.a.switchScreen(d.winScreen);else if(e.keyCode===n.a.VK_ESCAPE)o.a.switchScreen(d.loseScreen);else if(e.keyCode in f.keys){var r=f.keys[e.keyCode];if(-1===r)return f.map.engine.unlock(),!0;var i=n.a.DIRS[8][r];f.move(new h.a(i[0],i[1])),f.map.engine.unlock()}}},d.winScreen={enter:function(){console.log("Entered win screen.")},exit:function(){console.log("Exited win screen.")},render:function(t){for(var e=0;e<22;e++){var r=Math.round(255*Math.random()),i=Math.round(255*Math.random()),o=Math.round(255*Math.random()),s=n.a.Color.toRGB([r,i,o]);t.drawText(2,e+1,"%b{"+s+"}You win!")}},handleInput:function(t,e){}},d.loseScreen={enter:function(){console.log("Entered lose screen.")},exit:function(){console.log("Exited lose screen.")},render:function(t){for(var e=0;e<22;e++)t.drawText(2,e+1,"%b{red}You lose! :(")},handleInput:function(t,e){}},e.a=d},function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}function o(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=r(6),a=r(1),h=function(t){function e(t){i(this,e);var r=a.c[t],o=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,r));return o.type=t,o.isWalkable=r.isWalkable||!1,o.isDiggable=r.isDiggable||!1,o.isBumpable=!1,"function"===typeof r.bump&&(o.isBumpable=!0,o.bump=r.bump),o}return o(e,t),e}(s.a);e.a=h},function(t,e,r){"use strict";function i(){}function n(t){try{return t.then}catch(t){return y=t,m}}function o(t,e){try{return t(e)}catch(t){return y=t,m}}function s(t,e,r){try{t(e,r)}catch(t){return y=t,m}}function a(t){if("object"!==typeof this)throw new TypeError("Promises must be constructed via new");if("function"!==typeof t)throw new TypeError("not a function");this._45=0,this._81=0,this._65=null,this._54=null,t!==i&&d(t,this)}function h(t,e,r){return new t.constructor(function(n,o){var s=new a(i);s.then(n,o),c(t,new _(e,r,s))})}function c(t,e){for(;3===t._81;)t=t._65;if(a._10&&a._10(t),0===t._81)return 0===t._45?(t._45=1,void(t._54=e)):1===t._45?(t._45=2,void(t._54=[t._54,e])):void t._54.push(e);u(t,e)}function u(t,e){g(function(){var r=1===t._81?e.onFulfilled:e.onRejected;if(null===r)return void(1===t._81?l(e.promise,t._65):p(e.promise,t._65));var i=o(r,t._65);i===m?p(e.promise,y):l(e.promise,i)})}function l(t,e){if(e===t)return p(t,new TypeError("A promise cannot be resolved with itself."));if(e&&("object"===typeof e||"function"===typeof e)){var r=n(e);if(r===m)return p(t,y);if(r===t.then&&e instanceof a)return t._81=3,t._65=e,void f(t);if("function"===typeof r)return void d(r.bind(e),t)}t._81=1,t._65=e,f(t)}function p(t,e){t._81=2,t._65=e,a._97&&a._97(t,e),f(t)}function f(t){if(1===t._45&&(c(t,t._54),t._54=null),2===t._45){for(var e=0;e<t._54.length;e++)c(t,t._54[e]);t._54=null}}function _(t,e,r){this.onFulfilled="function"===typeof t?t:null,this.onRejected="function"===typeof e?e:null,this.promise=r}function d(t,e){var r=!1,i=s(t,function(t){r||(r=!0,l(e,t))},function(t){r||(r=!0,p(e,t))});r||i!==m||(r=!0,p(e,y))}var g=r(15),y=null,m={};t.exports=a,a._10=null,a._97=null,a._61=i,a.prototype.then=function(t,e){if(this.constructor!==a)return h(this,t,e);var r=new a(i);return c(this,new _(t,e,r)),r}},function(t,e,r){var i;!function(){"use strict";function n(t){return s(a(t),arguments)}function o(t,e){return n.apply(null,[t].concat(e||[]))}function s(t,e){var r,i,o,s,a,c,u,l,p,f=1,_=t.length,d="";for(i=0;i<_;i++)if("string"===typeof t[i])d+=t[i];else if(Array.isArray(t[i])){if(s=t[i],s[2])for(r=e[f],o=0;o<s[2].length;o++){if(!r.hasOwnProperty(s[2][o]))throw new Error(n('[sprintf] property "%s" does not exist',s[2][o]));r=r[s[2][o]]}else r=s[1]?e[s[1]]:e[f++];if(h.not_type.test(s[8])&&h.not_primitive.test(s[8])&&r instanceof Function&&(r=r()),h.numeric_arg.test(s[8])&&"number"!==typeof r&&isNaN(r))throw new TypeError(n("[sprintf] expecting number but found %T",r));switch(h.number.test(s[8])&&(l=r>=0),s[8]){case"b":r=parseInt(r,10).toString(2);break;case"c":r=String.fromCharCode(parseInt(r,10));break;case"d":case"i":r=parseInt(r,10);break;case"j":r=JSON.stringify(r,null,s[6]?parseInt(s[6]):0);break;case"e":r=s[7]?parseFloat(r).toExponential(s[7]):parseFloat(r).toExponential();break;case"f":r=s[7]?parseFloat(r).toFixed(s[7]):parseFloat(r);break;case"g":r=s[7]?String(Number(r.toPrecision(s[7]))):parseFloat(r);break;case"o":r=(parseInt(r,10)>>>0).toString(8);break;case"s":r=String(r),r=s[7]?r.substring(0,s[7]):r;break;case"t":r=String(!!r),r=s[7]?r.substring(0,s[7]):r;break;case"T":r=Object.prototype.toString.call(r).slice(8,-1).toLowerCase(),r=s[7]?r.substring(0,s[7]):r;break;case"u":r=parseInt(r,10)>>>0;break;case"v":r=r.valueOf(),r=s[7]?r.substring(0,s[7]):r;break;case"x":r=(parseInt(r,10)>>>0).toString(16);break;case"X":r=(parseInt(r,10)>>>0).toString(16).toUpperCase()}h.json.test(s[8])?d+=r:(!h.number.test(s[8])||l&&!s[3]?p="":(p=l?"+":"-",r=r.toString().replace(h.sign,"")),c=s[4]?"0"===s[4]?"0":s[4].charAt(1):" ",u=s[6]-(p+r).length,a=s[6]&&u>0?c.repeat(u):"",d+=s[5]?p+r+a:"0"===c?p+a+r:a+p+r)}return d}function a(t){if(c[t])return c[t];for(var e,r=t,i=[],n=0;r;){if(null!==(e=h.text.exec(r)))i.push(e[0]);else if(null!==(e=h.modulo.exec(r)))i.push("%");else{if(null===(e=h.placeholder.exec(r)))throw new SyntaxError("[sprintf] unexpected placeholder");if(e[2]){n|=1;var o=[],s=e[2],a=[];if(null===(a=h.key.exec(s)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(o.push(a[1]);""!==(s=s.substring(a[0].length));)if(null!==(a=h.key_access.exec(s)))o.push(a[1]);else{if(null===(a=h.index_access.exec(s)))throw new SyntaxError("[sprintf] failed to parse named argument key");o.push(a[1])}e[2]=o}else n|=2;if(3===n)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");i.push(e)}r=r.substring(e[0].length)}return c[t]=i}var h={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[\+\-]/},c=Object.create(null);e.sprintf=n,e.vsprintf=o,"undefined"!==typeof window&&(window.sprintf=n,window.vsprintf=o,void 0!==(i=function(){return{sprintf:n,vsprintf:o}}.call(e,r,e,t))&&(t.exports=i))}()},function(t,e){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(t){"object"===typeof window&&(r=window)}t.exports=r},function(t,e,r){"use strict";"undefined"===typeof Promise&&(r(23).enable(),window.Promise=r(22)),r(24),Object.assign=r(20)},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(0),n=r.n(i),o=r(4);n.a.isSupported()?o.a.init():alert("The rot.js library isn't supported by your browser.")},function(t,e,r){"use strict";(function(e){function r(t){s.length||(o(),a=!0),s[s.length]=t}function i(){for(;h<s.length;){var t=h;if(h+=1,s[t].call(),h>c){for(var e=0,r=s.length-h;e<r;e++)s[e]=s[e+h];s.length-=h,h=0}}s.length=0,h=0,a=!1}function n(t){return function(){function e(){clearTimeout(r),clearInterval(i),t()}var r=setTimeout(e,0),i=setInterval(e,50)}}t.exports=r;var o,s=[],a=!1,h=0,c=1024,u="undefined"!==typeof e?e:self,l=u.MutationObserver||u.WebKitMutationObserver;o="function"===typeof l?function(t){var e=1,r=new l(t),i=document.createTextNode("");return r.observe(i,{characterData:!0}),function(){e=-e,i.data=e}}(i):n(i),r.requestFlush=o,r.makeRequestCallFromTimer=n}).call(e,r(12))},function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var n=r(0),o=r.n(n),s=r(9),a=r(5),h=r(3),c=r(2),u=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),l=function(){function t(e,r){i(this,t),p.call(this),this.tiles=e,this.width=e.length,this.height=e[0].length,this.entities=[],this.scheduler=new o.a.Scheduler.Simple,this.engine=new o.a.Engine(this.scheduler),this.addEntityAtRandomPosition(r);for(var n=0;n<50;n++)this.addEntityAtRandomPosition(new h.a(c.b));this.addEntityAtRandomPosition(new h.a(c.c))}return u(t,[{key:"getTile",value:function(t){return this.isInBounds(t)?this.tiles[t.x][t.y]||new s.a("null"):new s.a("null")}},{key:"dig",value:function(t){this.getTile(t).isDiggable&&(this.tiles[t.x][t.y]=new s.a("floor"))}},{key:"getRandomFloorTile",value:function(){var t=void 0,e=void 0;do{t=Math.floor(o.a.RNG.getUniform()*this.width),e=Math.floor(o.a.RNG.getUniform()*this.width)}while(!this.isEmptyFloor(new a.a(t,e)));return new a.a(t,e)}},{key:"isInBounds",value:function(t){return t.x>0&&t.x<this.width&&t.y>0&&t.y<this.height}},{key:"getEntityAt",value:function(t){for(var e=0;e<this.entities.length;e++)if(this.entities[e].xy.is(t))return this.entities[e];return!1}},{key:"addEntity",value:function(t){if(!this.isInBounds(t.xy))throw new Error("Adding entity out of bounds.");t.map=this,this.entities.push(t),t.hasMixin("Actor")&&this.scheduler.add(t,!0)}},{key:"addEntityAtRandomPosition",value:function(t){t.xy=this.getRandomFloorTile(),this.addEntity(t)}},{key:"isEmptyFloor",value:function(t){return"floor"===this.getTile(t).type&&!this.getEntityAt(t)}},{key:"removeEntity",value:function(t){for(var e=0;e<this.entities.length;e++)if(this.entities[e]===t){this.entities.splice(e,1);break}t.hasMixin("Actor")&&this.scheduler.remove(t)}}]),t}(),p=function(){this.getEntitiesWithinRadius=function(t,e){for(var r=[],i=t.x-e,n=t.x+e,o=t.y-e,s=t.y+e,a=0;a<this.entities.length;a++)this.entities[a].xy.x>=i&&this.entities[a].xy.x<=n&&this.entities[a].xy.y>=o&&this.entities[a].xy.y<=s&&r.push(this.entities[a]);return r}};e.a=l},function(t,e,r){"use strict";function i(t){for(var e=[],r=0;r<a.b.width;r++){e.push([]);for(var i=0;i<a.b.height;i++)e[r].push(new h.a("null"))}var n=new o.a.Map.Digger(a.b.width,a.b.height);n.create(function(t,r,i){e[t][r]=i?new h.a("wall"):new h.a("floor")});for(var c=n.getRooms(),u=0;u<c.length;u++)c[u].getDoors(function(t,r){o.a.RNG.getUniform()>=.5&&(e[t][r]=new h.a("door"))});return new s.a(e,t)}e.a=i;var n=r(0),o=r.n(n),s=r(16),a=r(1),h=r(9)},function(t,e,r){"use strict";function i(t,e,r){t.hasMixin(o.a.MessageRecipient)&&(r&&(e=h(e,r)),t.receiveMessage(e))}function n(t,e,r,n){for(var o=t.getEntitiesWithinRadius(e,5),s=0;s<o.length;s++)i(o[s],r,n)}e.a=i,e.b=n;var o=r(7),s=r(11),a=r.n(s),h=a.a.vsprintf;a.a.sprintf},function(t,e,r){var i,i;!function(e){t.exports=e()}(function(){return function t(e,r,n){function o(a,h){if(!r[a]){if(!e[a]){var c="function"==typeof i&&i;if(!h&&c)return i(a,!0);if(s)return s(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=r[a]={exports:{}};e[a][0].call(l.exports,function(t){var r=e[a][1][t];return o(r||t)},l,l.exports,t,e,r,n)}return r[a].exports}for(var s="function"==typeof i&&i,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(t,e,r){e.exports={name:"dice.js",version:"0.9.3",description:"A parser and evaluator for a useful rpg dice syntax.",main:"build/dice.js",directories:{test:"tests"},dependencies:{},devDependencies:{browserify:"~14.1.0","jasmine-core":"^2.5.2","jasmine-node":"~1.14.5",karma:"~1.5.0","karma-chrome-launcher":"~2.0","karma-firefox-launcher":"~1.0.1","karma-jasmine":"~1.1","karma-phantomjs-launcher":"~1.0.4",pegjs:"~0.10.0"},scripts:{test:"make test"},repository:{type:"git",url:"https://github.com/lordnull/dice.js.git"},keywords:["rpg","dice","parser","roll","peg"],author:"Micah Warren (Lord Null)",license:"MIT",bugs:{url:"https://github.com/lordnull/dice.js/issues"},homepage:"https://github.com/lordnull/dice.js"}},{}],2:[function(t,e,r){function i(t,e){var r=c.parse(t);return c.eval(r,e)}function n(t,e){if("static"==t.op)return[t.value,t.value];if("lookup"==t.op){var r=c.ops.lookup.call(t,e);return[r(e),r(e)]}if("floor"==t.op){var i=n(t.args[0],e);return[Math.floor(i[0]),Math.floor(i[1])]}if("ceil"==t.op){var i=n(t.args[0],e);return[Math.ceil(i[0]),Math.ceil(i[1])]}if("round"==t.op){var i=n(t.args[0],e);return[Math.round(i[0]),Math.round(i[1])]}if("d"==t.op){var o=n(t.args[0],e),s=n(t.args[1],e),a=s[0]*o[0],h=s[1]*o[1];return[a,h]}if("w"==t.op){var o=n(t.args[0],e),s=n(t.args[1],e),a=s[0]*o[0],h=s[1]*o[1];return[a,h]}if("random"==t.op){var u=n(t.args[0],e),l=n(t.args[1],e);return[u[0],l[1]]}if("+"==t.op){var p=n(t.args[0],e),f=n(t.args[1],e),a=p[0]+f[0],h=p[1]+f[1];return[a,h]}if("-"==t.op){var p=n(t.args[0],e),f=n(t.args[1],e),a=p[0]-f[0],h=p[1]-f[1];return[a,h]}if("*"==t.op){var p=n(t.args[0],e),f=n(t.args[1],e),a=p[0]*f[0],h=p[1]*f[1];return[a,h]}if("/"==t.op){var p=n(t.args[0],e),f=n(t.args[1],e),a=p[0]/f[1],h=p[1]/f[0];return[a,h]}return"paren_express"==t.op?n(t.args[0],e):void 0}function o(t){var e=h(t.expression),r=t.op[0];return"p"===r&&(r=""),r+"( "+e+" )"}function s(t){var e=h(t.rightSide),r=h(t.leftSide);return e+" "+t.op+" "+r}function a(t){var e=t.min>1?t.min+"..":"";return t.x+t.mode+e+t.max+":["+t.rolls.join(", ")+"]"}function h(t){return t.expression?o(t):t.op?s(t):t.rolls?a(t):t.toString()}var c={parse:t("./parser").parse,eval:t("./evaluate").eval,ops:t("./evaluate").ops,version:t("../package").version};c.roll=i,c.statistics=function(t,e,r){"number"==typeof e&&(r=e,e={}),e=e||{},r=r||1e3;var o,s=[];for(o=0;o<r;o++)s.push(i(t,e));var a=s.reduce(function(t,e){return t+e},0)/r,h=s.reduce(function(t,e){return t<e?t:e},s[0]),u=s.reduce(function(t,e){return t>e?t:e},s[0]),l=c.parse(t),p=n(l,e);return{results:s,mean:a,min:parseInt(h.toFixed()),max:parseInt(u.toFixed()),min_possible:p[0],max_possible:p[1]}},c.stringify=h;var u;for(u in c)r[u]=c[u]},{"../package":1,"./evaluate":3,"./parser":4}],3:[function(t,e,r){function i(t){var e=[];e[t]=!0;for(var r=0;r<e.length;r++)e[r]=!0;return e}function n(t){return t=t||[],t.map(o)}function o(t){var e=n(t.args);return s[t.op].apply(t,e)}var s={static:function(){var t=this.value;return function(){return t}},lookup:function(){var t=this.value;return function(e){var r=e[t];if(void 0!=r)return r;var i=t.split(".");return t==i?r:(reduceRes=i.reduce(function(t,e){if(void 0!=t)return t[e]},e),reduceRes)}},floor:function(t){return function(e){var r=t(e),i=new Number(Math.floor(r));return i.op="floor",i.expression=r,i}},ceil:function(t){return function(e){var r=t(e),i=new Number(Math.ceil(r));return i.op="ceil",i.expression=r,i}},round:function(t){return function(e){var r=t(e),i=new Number(Math.round(r));return i.op="round",i.expression=r,i}},d:function(t,e){return function(r){var n,o,s=t(r),a=i(s-1),h=a.map(function(){var t=e(r);return n=t.min,o=t.max,t}),c=h.reduce(function(t,e){return t+e},0);return c=new Number(c),c.rolls=h,c.min=n,c.max=o,c.x=s,c.mode="d",c}},w:function(t,e){return function(r){var n,o,s=t(r),a=i(s-1),h=a.map(function(){var t=e(r),i=0;if(n=e.min,o=e.max,e.min===e.max)return t;for(;t===e.max;)i+=t,t=mimMax(r);return i}),c=h.reduce(function(t,e){return t+e},0);return c=new Number(c),c.rolls=h,c.min=n,c.max=o,c.x=s,c.mode="w",c}},random:function(t,e){return function(r){var i=Math.random(),n=e(r),o=t(r),s=n-o,i=s*i,a=Math.round(i+o);return a=new Number(a),a.min=o,a.max=n,a}},"+":function(t,e){return function(r){var i=t(r),n=e(r),o=i+n;return o=new Number(o),o.op="+",o.rightSide=i,o.leftSide=n,o}},"-":function(t,e){return function(r){var i=t(r),n=e(r),o=i-n;return o=new Number(o),o.op="-",o.rightSide=i,o.leftSide=n,o}},"*":function(t,e){return function(r){var i=t(r),n=e(r),o=i*n;return o=new Number(o),o.op="*",o.rightSide=i,o.leftSide=n,o}},"/":function(t,e){return function(r){var i=t(r),n=e(r),o=i/n;return o=new Number(o),o.op="/",o.rightSide=i,o.leftSide=n,o}},paren_express:function(t){return function(e){var r=t(e);return outtots=new Number(r),outtots.op="paren_express",outtots.expression=r,outtots}}};r.eval=function(t,e){return e=e||{},o(t)(e)},r.ops=s},{}],4:[function(t,e,r){"use strict";function i(t,e,r,n){this.message=t,this.expected=e,this.found=r,this.location=n,this.name="SyntaxError","function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,i)}function n(t,e){function r(t,e){return{type:"literal",text:t,ignoreCase:e}}function n(t,e,r){return{type:"class",parts:t,inverted:e,ignoreCase:r}}function o(t){return{type:"other",description:t}}function s(e){var r,i=Gt[e];if(i)return i;for(r=e-1;!Gt[r];)r--;for(i=Gt[r],i={line:i.line,column:i.column};r<e;)10===t.charCodeAt(r)?(i.line++,i.column=1):i.column++,r++;return Gt[e]=i,i}function a(t,e){var r=s(t),i=s(e);return{start:{offset:t,line:r.line,column:r.column},end:{offset:e,line:i.line,column:i.column}}}function h(t){Wt<Ht||(Wt>Ht&&(Ht=Wt,zt=[]),zt.push(t))}function c(t,e,r){return new i(i.buildMessage(t,e),t,e,r)}function u(){return l()}function l(){var t,e,r,i;return t=Wt,e=_(),e!==E?(r=g(),r!==E?(i=d(),i!==E?(Bt=t,e=V(e,r,i),t=e):(Wt=t,t=E)):(Wt=t,t=E)):(Wt=t,t=E),t===E&&(t=Wt,e=d(),e!==E&&(Bt=t,e=D(e)),(t=e)===E&&(t=Wt,e=p(),e!==E&&(Bt=t,e=D(e)),t=e)),t}function p(){var e,r,i,n,o,s;return e=Wt,40===t.charCodeAt(Wt)?(r=K,Wt++):(r=E,0===Xt&&h(F)),r!==E?(i=w(),i!==E?(n=l(),n!==E?(o=w(),o!==E?(41===t.charCodeAt(Wt)?(s=O,Wt++):(s=E,0===Xt&&h(P)),s!==E?(Bt=e,r=N(n),e=r):(Wt=e,e=E)):(Wt=e,e=E)):(Wt=e,e=E)):(Wt=e,e=E)):(Wt=e,e=E),e}function f(){var e,r,i,n;return e=Wt,r=w(),r!==E?(42===t.charCodeAt(Wt)?(i=I,Wt++):(i=E,0===Xt&&h(U)),i!==E?(n=w(),n!==E?(Bt=e,r=L(),e=r):(Wt=e,e=E)):(Wt=e,e=E)):(Wt=e,e=E),e===E&&(e=Wt,r=w(),r!==E?(47===t.charCodeAt(Wt)?(i=j,Wt++):(i=E,0===Xt&&h(W)),i!==E?(n=w(),n!==E?(Bt=e,r=B(),e=r):(Wt=e,e=E)):(Wt=e,e=E)):(Wt=e,e=E)),e}function _(){var t,e,r,i;return t=Wt,e=y(),e!==E?(r=f(),r!==E?(i=_(),i!==E?(Bt=t,e=G(e,r,i),t=e):(Wt=t,t=E)):(Wt=t,t=E)):(Wt=t,t=E),t===E&&(t=Wt,e=p(),e!==E?(r=f(),r!==E?(i=_(),i!==E?(Bt=t,e=G(e,r,i),t=e):(Wt=t,t=E)):(Wt=t,t=E)):(Wt=t,t=E),t===E&&(t=Wt,e=y(),e!==E&&(Bt=t,e=H(e)),(t=e)===E&&(t=Wt,e=p(),e!==E&&(Bt=t,e=z(e)),t=e))),t}function d(){var t,e,r,i;return t=Wt,e=_(),e!==E?(r=g(),r!==E?(i=d(),i!==E?(Bt=t,e=X(e,r,i),t=e):(Wt=t,t=E)):(Wt=t,t=E)):(Wt=t,t=E),t===E&&(t=Wt,e=_(),e!==E&&(Bt=t,e=Y(e)),(t=e)===E&&(t=Wt,e=p(),e!==E&&(Bt=t,e=Y(e)),t=e)),t}function g(){var e,r,i,n;return e=Wt,r=w(),r!==E?(43===t.charCodeAt(Wt)?(i=q,Wt++):(i=E,0===Xt&&h(Q)),i!==E?(n=w(),n!==E?(Bt=e,r=J(),e=r):(Wt=e,e=E)):(Wt=e,e=E)):(Wt=e,e=E),e===E&&(e=Wt,r=w(),r!==E?(45===t.charCodeAt(Wt)?(i=$,Wt++):(i=E,0===Xt&&h(Z)),i!==E?(n=w(),n!==E?(Bt=e,r=tt(),e=r):(Wt=e,e=E)):(Wt=e,e=E)):(Wt=e,e=E)),e}function y(){var t,e,r,i;return t=Wt,e=x(),e!==E?(r=m(),r!==E?(i=v(),i!==E?(Bt=t,e=et(e,r,i),t=e):(Wt=t,t=E)):(Wt=t,t=E)):(Wt=t,t=E),t===E&&(t=Wt,e=m(),e!==E?(r=v(),r!==E?(Bt=t,e=rt(e,r),t=e):(Wt=t,t=E)):(Wt=t,t=E),t===E&&(t=Wt,e=b(),e!==E&&(Bt=t,e=it(e)),(t=e)===E&&(t=Wt,e=x(),e!==E&&(Bt=t,e=nt(e)),t=e))),t}function m(){var e;return 100===t.charCodeAt(Wt)?(e=ot,Wt++):(e=E,0===Xt&&h(st)),e===E&&(119===t.charCodeAt(Wt)?(e=at,Wt++):(e=E,0===Xt&&h(ht))),e}function v(){var t,e;return t=Wt,e=b(),e!==E&&(Bt=t,e=ct(e)),t=e,t===E&&(t=Wt,e=x(),e!==E&&(Bt=t,e=ut(e)),t=e),t}function b(){var e,r,i,n;return e=Wt,r=x(),r!==E?(t.substr(Wt,2)===lt?(i=lt,Wt+=2):(i=E,0===Xt&&h(pt)),i!==E?(n=x(),n!==E?(Bt=e,r=ft(r,n),e=r):(Wt=e,e=E)):(Wt=e,e=E)):(Wt=e,e=E),e}function w(){var e,r;for(e=[],_t.test(t.charAt(Wt))?(r=t.charAt(Wt),Wt++):(r=E,0===Xt&&h(dt));r!==E;)e.push(r),_t.test(t.charAt(Wt))?(r=t.charAt(Wt),Wt++):(r=E,0===Xt&&h(dt));return e}function x(){var t,e,r;return t=Wt,e=S(),e!==E&&(Bt=t,e=gt(e)),t=e,t===E&&(t=Wt,e=T(),e!==E&&(Bt=t,e=yt(e)),(t=e)===E&&(t=Wt,e=M(),e!==E?(r=T(),r!==E?(Bt=t,e=mt(e,r),t=e):(Wt=t,t=E)):(Wt=t,t=E),t===E&&(t=Wt,e=M(),e!==E?(r=p(),r!==E?(Bt=t,e=vt(e,r),t=e):(Wt=t,t=E)):(Wt=t,t=E)))),t}function M(){var e,r;return e=Wt,102===t.charCodeAt(Wt)?(r=bt,Wt++):(r=E,0===Xt&&h(wt)),r!==E&&(Bt=e,r=xt()),e=r,e===E&&(e=Wt,114===t.charCodeAt(Wt)?(r=Mt,Wt++):(r=E,0===Xt&&h(Tt)),r!==E&&(Bt=e,r=kt()),(e=r)===E&&(e=Wt,99===t.charCodeAt(Wt)?(r=St,Wt++):(r=E,0===Xt&&h(Rt)),r!==E&&(Bt=e,r=Et()),e=r)),e}function T(){var t,e;return t=Wt,e=k(),e!==E&&(Bt=t,e=At(e)),t=e}function k(){var e,r,i,n;if(e=Wt,91===t.charCodeAt(Wt)?(r=Ct,Wt++):(r=E,0===Xt&&h(Vt)),r!==E){if(i=[],Dt.test(t.charAt(Wt))?(n=t.charAt(Wt),Wt++):(n=E,0===Xt&&h(Kt)),n!==E)for(;n!==E;)i.push(n),Dt.test(t.charAt(Wt))?(n=t.charAt(Wt),Wt++):(n=E,0===Xt&&h(Kt));else i=E;i!==E?(93===t.charCodeAt(Wt)?(n=Ft,Wt++):(n=E,0===Xt&&h(Ot)),n!==E?(Bt=e,r=Pt(i),e=r):(Wt=e,e=E)):(Wt=e,e=E)}else Wt=e,e=E;return e}function S(){var e,r,i,n;if(Xt++,e=Wt,r=[],It.test(t.charAt(Wt))?(i=t.charAt(Wt),Wt++):(i=E,0===Xt&&h(Ut)),i!==E)for(;i!==E;)r.push(i),It.test(t.charAt(Wt))?(i=t.charAt(Wt),Wt++):(i=E,0===Xt&&h(Ut));else r=E;if(r!==E&&(Bt=e,r=Lt(r)),(e=r)===E)if(e=Wt,45===t.charCodeAt(Wt)?(r=$,Wt++):(r=E,0===Xt&&h(Z)),r!==E){if(i=[],It.test(t.charAt(Wt))?(n=t.charAt(Wt),Wt++):(n=E,0===Xt&&h(Ut)),n!==E)for(;n!==E;)i.push(n),It.test(t.charAt(Wt))?(n=t.charAt(Wt),Wt++):(n=E,0===Xt&&h(Ut));else i=E;i!==E?(Bt=e,r=jt(i),e=r):(Wt=e,e=E)}else Wt=e,e=E;return Xt--,e===E&&(r=E,0===Xt&&h(Nt)),e}e=void 0!==e?e:{};var R,E={},A={start:u},C=u,V=function(t,e,r){return{op:e,args:[t,r]}},D=function(t){return t},K="(",F=r("(",!1),O=")",P=r(")",!1),N=function(t){return{op:"paren_express",args:[t]}},I="*",U=r("*",!1),L=function(){return"*"},j="/",W=r("/",!1),B=function(){return"/"},G=function(t,e,r){return{op:e,args:[t,r]}},H=function(t){return t},z=function(t){return t},X=function(t,e,r){return{op:e,args:[t,r]}},Y=function(t){return t},q="+",Q=r("+",!1),J=function(){return"+"},$="-",Z=r("-",!1),tt=function(){return"-"},et=function(t,e,r){return{op:e,args:[t,r]}},rt=function(t,e){return{op:t,args:[{op:"static",value:1},e]}},it=function(t){return{op:"d",args:[{op:"static",value:1},t]}},nt=function(t){return t},ot="d",st=r("d",!1),at="w",ht=r("w",!1),ct=function(t){return t},ut=function(t){return{op:"random",args:[{op:"static",args:[],value:1},t]}},lt="..",pt=r("..",!1),ft=function(t,e){return{op:"random",args:[t,e]}},_t=/^[ ]/,dt=n([" "],!1,!1),gt=function(t){return{op:"static",value:t}},yt=function(t){return t},mt=function(t,e){return{op:t,args:[e]}},vt=function(t,e){return{op:t,args:e.args}},bt="f",wt=r("f",!1),xt=function(){return"floor"},Mt="r",Tt=r("r",!1),kt=function(){return"round"},St="c",Rt=r("c",!1),Et=function(){return"ceil"},At=function(t){return{op:"lookup",value:t}},Ct="[",Vt=r("[",!1),Dt=/^[^[\]]/,Kt=n(["[","]"],!0,!1),Ft="]",Ot=r("]",!1),Pt=function(t){return t.join("")},Nt=o("integer"),It=/^[0-9]/,Ut=n([["0","9"]],!1,!1),Lt=function(t){return parseInt(t.join(""),10)},jt=function(t){return-1*parseInt(t.join(""),10)},Wt=0,Bt=0,Gt=[{line:1,column:1}],Ht=0,zt=[],Xt=0;if("startRule"in e){if(!(e.startRule in A))throw new Error("Can't start parsing from rule \""+e.startRule+'".');C=A[e.startRule]}if((R=C())!==E&&Wt===t.length)return R;throw R!==E&&Wt<t.length&&h(function(){return{type:"end"}}()),c(zt,Ht<t.length?t.charAt(Ht):null,Ht<t.length?a(Ht,Ht+1):a(Ht,Ht))}!function(t,e){function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r}(i,Error),i.buildMessage=function(t,e){function r(t){return t.charCodeAt(0).toString(16).toUpperCase()}function i(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(t){return"\\x0"+r(t)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(t){return"\\x"+r(t)})}function n(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(t){return"\\x0"+r(t)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(t){return"\\x"+r(t)})}function o(t){return s[t.type](t)}var s={literal:function(t){return'"'+i(t.text)+'"'},class:function(t){var e,r="";for(e=0;e<t.parts.length;e++)r+=t.parts[e]instanceof Array?n(t.parts[e][0])+"-"+n(t.parts[e][1]):n(t.parts[e]);return"["+(t.inverted?"^":"")+r+"]"},any:function(t){return"any character"},end:function(t){return"end of input"},other:function(t){return t.description}};return"Expected "+function(t){var e,r,i=new Array(t.length);for(e=0;e<t.length;e++)i[e]=o(t[e]);if(i.sort(),i.length>0){for(e=1,r=1;e<i.length;e++)i[e-1]!==i[e]&&(i[r]=i[e],r++);i.length=r}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(t)+" but "+function(t){return t?'"'+i(t)+'"':"end of input"}(e)+" found."},e.exports={SyntaxError:i,parse:n}},{}]},{},[2])(2)})},function(t,e,r){"use strict";function i(t){if(null===t||void 0===t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}var n=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable;t.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},r=0;r<10;r++)e["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(t){return e[t]}).join(""))return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach(function(t){i[t]=t}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},i)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var r,a,h=i(t),c=1;c<arguments.length;c++){r=Object(arguments[c]);for(var u in r)o.call(r,u)&&(h[u]=r[u]);if(n){a=n(r);for(var l=0;l<a.length;l++)s.call(r,a[l])&&(h[a[l]]=r[a[l]])}}return h}},function(t,e){function r(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function n(t){if(u===setTimeout)return setTimeout(t,0);if((u===r||!u)&&setTimeout)return u=setTimeout,setTimeout(t,0);try{return u(t,0)}catch(e){try{return u.call(null,t,0)}catch(e){return u.call(this,t,0)}}}function o(t){if(l===clearTimeout)return clearTimeout(t);if((l===i||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(t);try{return l(t)}catch(e){try{return l.call(null,t)}catch(e){return l.call(this,t)}}}function s(){d&&f&&(d=!1,f.length?_=f.concat(_):g=-1,_.length&&a())}function a(){if(!d){var t=n(s);d=!0;for(var e=_.length;e;){for(f=_,_=[];++g<e;)f&&f[g].run();g=-1,e=_.length}f=null,d=!1,o(t)}}function h(t,e){this.fun=t,this.array=e}function c(){}var u,l,p=t.exports={};!function(){try{u="function"===typeof setTimeout?setTimeout:r}catch(t){u=r}try{l="function"===typeof clearTimeout?clearTimeout:i}catch(t){l=i}}();var f,_=[],d=!1,g=-1;p.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];_.push(new h(t,e)),1!==_.length||d||n(a)},h.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=c,p.addListener=c,p.once=c,p.off=c,p.removeListener=c,p.removeAllListeners=c,p.emit=c,p.prependListener=c,p.prependOnceListener=c,p.listeners=function(t){return[]},p.binding=function(t){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(t){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},function(t,e,r){"use strict";function i(t){var e=new n(n._61);return e._81=1,e._65=t,e}var n=r(10);t.exports=n;var o=i(!0),s=i(!1),a=i(null),h=i(void 0),c=i(0),u=i("");n.resolve=function(t){if(t instanceof n)return t;if(null===t)return a;if(void 0===t)return h;if(!0===t)return o;if(!1===t)return s;if(0===t)return c;if(""===t)return u;if("object"===typeof t||"function"===typeof t)try{var e=t.then;if("function"===typeof e)return new n(e.bind(t))}catch(t){return new n(function(e,r){r(t)})}return i(t)},n.all=function(t){var e=Array.prototype.slice.call(t);return new n(function(t,r){function i(s,a){if(a&&("object"===typeof a||"function"===typeof a)){if(a instanceof n&&a.then===n.prototype.then){for(;3===a._81;)a=a._65;return 1===a._81?i(s,a._65):(2===a._81&&r(a._65),void a.then(function(t){i(s,t)},r))}var h=a.then;if("function"===typeof h){return void new n(h.bind(a)).then(function(t){i(s,t)},r)}}e[s]=a,0===--o&&t(e)}if(0===e.length)return t([]);for(var o=e.length,s=0;s<e.length;s++)i(s,e[s])})},n.reject=function(t){return new n(function(e,r){r(t)})},n.race=function(t){return new n(function(e,r){t.forEach(function(t){n.resolve(t).then(e,r)})})},n.prototype.catch=function(t){return this.then(null,t)}},function(t,e,r){"use strict";function i(){c=!1,a._10=null,a._97=null}function n(t){function e(e){(t.allRejections||s(l[e].error,t.whitelist||h))&&(l[e].displayId=u++,t.onUnhandled?(l[e].logged=!0,t.onUnhandled(l[e].displayId,l[e].error)):(l[e].logged=!0,o(l[e].displayId,l[e].error)))}function r(e){l[e].logged&&(t.onHandled?t.onHandled(l[e].displayId,l[e].error):l[e].onUnhandled||(console.warn("Promise Rejection Handled (id: "+l[e].displayId+"):"),console.warn('  This means you can ignore any previous messages of the form "Possible Unhandled Promise Rejection" with id '+l[e].displayId+".")))}t=t||{},c&&i(),c=!0;var n=0,u=0,l={};a._10=function(t){2===t._81&&l[t._72]&&(l[t._72].logged?r(t._72):clearTimeout(l[t._72].timeout),delete l[t._72])},a._97=function(t,r){0===t._45&&(t._72=n++,l[t._72]={displayId:null,error:r,timeout:setTimeout(e.bind(null,t._72),s(r,h)?100:2e3),logged:!1})}}function o(t,e){console.warn("Possible Unhandled Promise Rejection (id: "+t+"):"),((e&&(e.stack||e))+"").split("\n").forEach(function(t){console.warn("  "+t)})}function s(t,e){return e.some(function(e){return t instanceof e})}var a=r(10),h=[ReferenceError,TypeError,RangeError],c=!1;e.disable=i,e.enable=n},function(t,e){!function(t){"use strict";function e(t){if("string"!==typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function r(t){return"string"!==typeof t&&(t=String(t)),t}function i(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return y.iterable&&(e[Symbol.iterator]=function(){return e}),e}function n(t){this.map={},t instanceof n?t.forEach(function(t,e){this.append(e,t)},this):Array.isArray(t)?t.forEach(function(t){this.append(t[0],t[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function o(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function s(t){return new Promise(function(e,r){t.onload=function(){e(t.result)},t.onerror=function(){r(t.error)}})}function a(t){var e=new FileReader,r=s(e);return e.readAsArrayBuffer(t),r}function h(t){var e=new FileReader,r=s(e);return e.readAsText(t),r}function c(t){for(var e=new Uint8Array(t),r=new Array(e.length),i=0;i<e.length;i++)r[i]=String.fromCharCode(e[i]);return r.join("")}function u(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function l(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t,t)if("string"===typeof t)this._bodyText=t;else if(y.blob&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(y.formData&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(y.searchParams&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(y.arrayBuffer&&y.blob&&v(t))this._bodyArrayBuffer=u(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!y.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(t)&&!b(t))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=u(t)}else this._bodyText="";this.headers.get("content-type")||("string"===typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):y.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},y.blob&&(this.blob=function(){var t=o(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?o(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(a)}),this.text=function(){var t=o(this);if(t)return t;if(this._bodyBlob)return h(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(c(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},y.formData&&(this.formData=function(){return this.text().then(_)}),this.json=function(){return this.text().then(JSON.parse)},this}function p(t){var e=t.toUpperCase();return w.indexOf(e)>-1?e:t}function f(t,e){e=e||{};var r=e.body;if(t instanceof f){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new n(t.headers)),this.method=t.method,this.mode=t.mode,r||null==t._bodyInit||(r=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new n(e.headers)),this.method=p(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function _(t){var e=new FormData;return t.trim().split("&").forEach(function(t){if(t){var r=t.split("="),i=r.shift().replace(/\+/g," "),n=r.join("=").replace(/\+/g," ");e.append(decodeURIComponent(i),decodeURIComponent(n))}}),e}function d(t){var e=new n;return t.split(/\r?\n/).forEach(function(t){var r=t.split(":"),i=r.shift().trim();if(i){var n=r.join(":").trim();e.append(i,n)}}),e}function g(t,e){e||(e={}),this.type="default",this.status="status"in e?e.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new n(e.headers),this.url=e.url||"",this._initBody(t)}if(!t.fetch){var y={searchParams:"URLSearchParams"in t,iterable:"Symbol"in t&&"iterator"in Symbol,blob:"FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in t,arrayBuffer:"ArrayBuffer"in t};if(y.arrayBuffer)var m=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],v=function(t){return t&&DataView.prototype.isPrototypeOf(t)},b=ArrayBuffer.isView||function(t){return t&&m.indexOf(Object.prototype.toString.call(t))>-1};n.prototype.append=function(t,i){t=e(t),i=r(i);var n=this.map[t];this.map[t]=n?n+","+i:i},n.prototype.delete=function(t){delete this.map[e(t)]},n.prototype.get=function(t){return t=e(t),this.has(t)?this.map[t]:null},n.prototype.has=function(t){return this.map.hasOwnProperty(e(t))},n.prototype.set=function(t,i){this.map[e(t)]=r(i)},n.prototype.forEach=function(t,e){for(var r in this.map)this.map.hasOwnProperty(r)&&t.call(e,this.map[r],r,this)},n.prototype.keys=function(){var t=[];return this.forEach(function(e,r){t.push(r)}),i(t)},n.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),i(t)},n.prototype.entries=function(){var t=[];return this.forEach(function(e,r){t.push([r,e])}),i(t)},y.iterable&&(n.prototype[Symbol.iterator]=n.prototype.entries);var w=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];f.prototype.clone=function(){return new f(this,{body:this._bodyInit})},l.call(f.prototype),l.call(g.prototype),g.prototype.clone=function(){return new g(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new n(this.headers),url:this.url})},g.error=function(){var t=new g(null,{status:0,statusText:""});return t.type="error",t};var x=[301,302,303,307,308];g.redirect=function(t,e){if(-1===x.indexOf(e))throw new RangeError("Invalid status code");return new g(null,{status:e,headers:{location:t}})},t.Headers=n,t.Request=f,t.Response=g,t.fetch=function(t,e){return new Promise(function(r,i){var n=new f(t,e),o=new XMLHttpRequest;o.onload=function(){var t={status:o.status,statusText:o.statusText,headers:d(o.getAllResponseHeaders()||"")};t.url="responseURL"in o?o.responseURL:t.headers.get("X-Request-URL");var e="response"in o?o.response:o.responseText;r(new g(e,t))},o.onerror=function(){i(new TypeError("Network request failed"))},o.ontimeout=function(){i(new TypeError("Network request failed"))},o.open(n.method,n.url,!0),"include"===n.credentials&&(o.withCredentials=!0),"responseType"in o&&y.blob&&(o.responseType="blob"),n.headers.forEach(function(t,e){o.setRequestHeader(e,t)}),o.send("undefined"===typeof n._bodyInit?null:n._bodyInit)})},t.fetch.polyfill=!0}}("undefined"!==typeof self?self:this)},function(t,e,r){r(13),t.exports=r(14)}]);
//# sourceMappingURL=main.2f077c10.js.map